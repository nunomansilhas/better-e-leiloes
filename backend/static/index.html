<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Leil√µes Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 70px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 24px 0;
            position: fixed;
            height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            box-shadow: 4px 0 12px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: width 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .sidebar:hover:not(.locked),
        .sidebar.locked {
            width: 260px;
        }

        .sidebar-lock {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-lock:hover {
            background: rgba(255,255,255,0.2);
        }

        .sidebar-lock svg {
            width: 16px;
            height: 16px;
        }

        .sidebar-header {
            padding: 0 24px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }

        .sidebar-header h1 svg {
            width: 24px !important;
            height: 24px !important;
            flex-shrink: 0;
        }

        .sidebar-header h1 span {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: opacity 0.3s ease, width 0.3s ease;
        }

        .sidebar:hover .sidebar-header h1 span,
        .sidebar.locked .sidebar-header h1 span {
            opacity: 1;
            width: auto;
        }

        .sidebar-header p {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover .sidebar-header p,
        .sidebar.locked .sidebar-header p {
            opacity: 1;
        }

        .sidebar-nav {
            margin-top: 24px;
            flex: 1;
        }

        .nav-section-label {
            padding: 8px 24px 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64748b;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover .nav-section-label,
        .sidebar.locked .nav-section-label {
            opacity: 1;
        }

        .nav-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 12px 16px;
        }

        .sidebar-bottom {
            margin-top: auto;
            padding-bottom: 16px;
        }

        /* ===== USER CARD - GLASSMORPHISM DESIGN ===== */
        .user-card {
            position: relative;
            padding: 7px;
            margin: 8px 7px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .sidebar:hover .user-card,
        .sidebar.locked .user-card {
            margin: 8px 12px;
            padding: 10px;
        }

        .user-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .sidebar:hover .user-card:hover,
        .sidebar.locked .user-card:hover {
            transform: translateY(-2px);
        }

        .user-card-header {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar:hover .user-card-header,
        .sidebar.locked .user-card-header {
            justify-content: flex-start;
            gap: 10px;
        }

        .user-card-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.8) 0%, rgba(168, 85, 247, 0.8) 100%);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .user-card-info {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            opacity: 0;
            width: 0;
            transition: all 0.2s;
        }

        .sidebar:hover .user-card-info,
        .sidebar.locked .user-card-info {
            opacity: 1;
            width: auto;
        }

        .user-card-name {
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            color: #f1f5f9;
        }

        .user-card-email {
            font-size: 11px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #94a3b8;
        }

        .user-card-toggle {
            margin-left: auto;
            color: #64748b;
            transition: transform 0.2s, opacity 0.2s;
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .sidebar:hover .user-card-toggle,
        .sidebar.locked .user-card-toggle {
            opacity: 1;
            width: auto;
        }

        .user-card.open .user-card-toggle {
            transform: rotate(180deg);
        }

        .user-card-dropdown {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease;
        }

        .user-card.open .user-card-dropdown {
            max-height: 100px;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            margin-top: 4px;
            font-size: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            color: #94a3b8;
        }

        .user-dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
        }

        .user-dropdown-item svg {
            width: 14px;
            height: 14px;
        }

        .user-dropdown-item.logout:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .nav-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #cbd5e1;
            font-size: 14px;
            font-weight: 500;
            border-left: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.15);
            border-left-color: #6366f1;
            color: white;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .nav-item span {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: opacity 0.3s ease, width 0.3s ease;
        }

        .sidebar:hover .nav-item span,
        .sidebar.locked .nav-item span {
            opacity: 1;
            width: auto;
        }

        .nav-dropdown {
            margin-top: 4px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-item.dropdown-open + .nav-dropdown {
            max-height: 200px;
        }

        .nav-dropdown-item {
            padding: 10px 24px 10px 56px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #94a3b8;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
        }

        .nav-dropdown-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }

        .nav-dropdown-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #818cf8;
        }

        .nav-dropdown-item svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .nav-dropdown-item span {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: opacity 0.3s ease, width 0.3s ease;
        }

        .sidebar:hover .nav-dropdown-item span,
        .sidebar.locked .nav-dropdown-item span {
            opacity: 1;
            width: auto;
        }

        /* Main Content */
        .main-content {
            margin-left: 70px;
            flex: 1;
            padding: 32px;
            width: calc(100% - 70px);
            transition: margin-left 0.3s ease, width 0.3s ease;
        }

        .sidebar:hover:not(.locked) ~ .main-content,
        .sidebar.locked ~ .main-content {
            margin-left: 260px;
            width: calc(100% - 260px);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 8px;
        }

        .page-header p {
            color: #64748b;
            font-size: 14px;
        }

        /* Stats Container - Total on left, 2x3 grid on right */
        .stats-container {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stats-total-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 140px;
            transition: all 0.2s ease;
        }

        .stats-total-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .stats-total-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .stats-total-value {
            font-size: 32px;
            font-weight: 700;
            color: #0f172a;
            line-height: 1.1;
        }

        .stats-total-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 2px;
        }

        .stats-total-breakdown {
            display: flex;
            gap: 12px;
            font-size: 13px;
            color: #64748b;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f1f5f9;
        }

        .stats-total-breakdown .lo {
            color: #f59e0b;
            font-weight: 600;
        }

        .stats-total-breakdown .np {
            color: #3b82f6;
            font-weight: 600;
        }

        /* Stats Grid - 2x3 for types */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 12px;
            flex: 1;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 14px 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            gap: 6px;
            transition: all 0.2s ease;
            position: relative;
        }

        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .stats-card-view-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: rgba(100, 116, 139, 0.1);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.5;
            transition: all 0.2s ease;
        }

        .stats-card-view-btn:hover {
            opacity: 1;
            background: rgba(59, 130, 246, 0.15);
        }

        .stats-card-view-btn svg {
            width: 14px;
            height: 14px;
            stroke: #64748b;
        }

        .stats-card-view-btn:hover svg {
            stroke: #3b82f6;
        }

        .stats-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-card-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .stats-card-icon.green { background: #f0fdf4; }
        .stats-card-icon.purple { background: #f5f3ff; }
        .stats-card-icon.orange { background: #fff7ed; }
        .stats-card-icon.cyan { background: #ecfeff; }
        .stats-card-icon.yellow { background: #fefce8; }
        .stats-card-icon.red { background: #fef2f2; }

        .stats-card-info {
            display: flex;
            flex-direction: column;
        }

        .stats-card-value {
            font-size: 20px;
            font-weight: 700;
            color: #0f172a;
            line-height: 1.2;
        }

        .stats-card-label {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stats-card-breakdown {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #64748b;
            padding-top: 4px;
            border-top: 1px solid #f1f5f9;
        }

        .stats-card-breakdown .lo {
            color: #f59e0b;
            font-weight: 600;
        }

        .stats-card-breakdown .np {
            color: #3b82f6;
            font-weight: 600;
        }

        @media (max-width: 900px) {
            .stats-container {
                flex-direction: column;
            }
            .stats-total-card {
                flex-direction: row;
                align-items: center;
                gap: 16px;
            }
            .stats-total-breakdown {
                margin-top: 0;
                padding-top: 0;
                border-top: none;
                border-left: 1px solid #f1f5f9;
                padding-left: 16px;
            }
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stats-bar-divider {
            width: 1px;
            height: 40px;
            background: linear-gradient(to bottom, transparent, #e2e8f0, transparent);
        }

        /* Side-by-side Dashboard Layout */
        .dashboard-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .dashboard-row .scraper-control-card {
            margin-top: 0;
        }

        @media (max-width: 1024px) {
            .dashboard-row {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            position: relative;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.03) 0%,
                transparent 100%);
            pointer-events: none;
            z-index: 0;
        }

        .stat-card > * {
            position: relative;
            z-index: 1;
        }

        .stat-card:hover {
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-4px) scale(1.01);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-card-title {
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon.blue {
            background: #eff6ff;
            color: #2563eb;
        }

        .stat-icon.purple {
            background: #f5f3ff;
            color: #7c3aed;
        }

        .stat-icon.green {
            background: #f0fdf4;
            color: #16a34a;
        }

        .stat-icon svg {
            width: 22px;
            height: 22px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #0f172a;
        }

        .stat-breakdown {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .stat-breakdown-item {
            flex: 1;
            text-align: center;
        }

        .stat-breakdown-label {
            font-size: 10px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .stat-breakdown-value {
            font-size: 20px;
            font-weight: 700;
            color: #0f172a;
        }

        .stat-breakdown-value.lo {
            color: #2563eb;
        }

        .stat-breakdown-value.np {
            color: #e11d48;
        }

        /* Scraper Control Card */
        .scraper-control-card {
            position: relative;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.4);
            margin-top: 24px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .scraper-control-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,
                rgba(139, 92, 246, 0.03) 0%,
                transparent 100%);
            pointer-events: none;
            z-index: 0;
        }

        .scraper-control-card > * {
            position: relative;
            z-index: 1;
        }

        .scraper-control-card:hover {
            box-shadow:
                0 12px 36px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border-color: rgba(139, 92, 246, 0.2);
        }

        .scraper-control-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .scraper-control-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: #0f172a;
        }

        .scraper-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .scraper-status.running {
            background: #dcfce7;
            color: #16a34a;
        }

        .scraper-status.stopped {
            background: #f1f5f9;
            color: #64748b;
        }

        .scraper-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .scraper-status.running .scraper-status-dot {
            background: #16a34a;
        }

        .scraper-status.stopped .scraper-status-dot {
            background: #94a3b8;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .scraper-controls {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: end;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 6px;
        }

        .control-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            color: #0f172a;
            background: white;
            cursor: pointer;
        }

        .scraper-buttons {
            display: flex;
            gap: 8px;
        }

        .scraper-btn {
            position: relative;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            overflow: hidden;
        }

        .scraper-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Outlined Start Button */
        .scraper-btn.start {
            background: transparent;
            color: #10b981;
            border: 2px solid #10b981;
            box-shadow: none;
        }

        .scraper-btn.start:hover:not(:disabled) {
            background: #10b981;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
        }

        .scraper-btn.start:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: none;
        }

        /* Outlined Stop Button */
        .scraper-btn.stop {
            background: transparent;
            color: #ef4444;
            border: 2px solid #ef4444;
            box-shadow: none;
        }

        .scraper-btn.stop:hover:not(:disabled) {
            background: #ef4444;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
        }

        .scraper-btn.stop:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: none;
        }

        /* Primary Outlined (Blue) */
        .scraper-btn.primary {
            background: transparent;
            color: #3b82f6;
            border: 2px solid #3b82f6;
        }

        .scraper-btn.primary:hover:not(:disabled) {
            background: #3b82f6;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        }

        /* Icon hover animation */
        .scraper-btn:hover:not(:disabled) > span:first-child {
            transform: scale(1.1);
        }

        .scraper-progress {
            margin-top: 16px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 6px;
            display: none;
        }

        .scraper-progress.active {
            display: block;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: #64748b;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Auto Pipeline Items */
        .auto-pipeline-item {
            padding: 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .auto-pipeline-item:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e0e7ff 100%);
            border-color: #c7d2fe;
            transform: translateX(2px);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 26px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.4);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        .toggle-slider:hover {
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.1),
                0 0 8px rgba(99, 102, 241, 0.3);
        }

        /* Status Indicator */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            margin-right: 6px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        /* Filters */
        .filters-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-input, .filter-select {
            padding: 10px 14px;
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #64748b;
            border: 1.5px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        /* Type Badges */
        .type-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .type-badge {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .type-badge.lo {
            background: #dbeafe;
            color: #1e40af;
        }

        .type-badge.lo.active {
            background: #2563eb;
            color: white;
            border-color: #1e40af;
        }

        .type-badge.np {
            background: #fce7f3;
            color: #9f1239;
        }

        .type-badge.np.active {
            background: #e11d48;
            color: white;
            border-color: #9f1239;
        }

        .type-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Events Grid */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 18px;
            margin-bottom: 32px;
        }

        /* Event Card */
        .event-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            transition: all 0.2s;
        }

        .event-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-4px);
        }

        .event-carousel {
            position: relative;
            width: 100%;
            height: 200px;
            background: #f1f5f9;
            overflow: hidden;
        }

        .event-carousel-images {
            display: flex;
            height: 100%;
            transition: transform 0.3s ease;
        }

        .event-carousel-image {
            min-width: 100%;
            height: 100%;
            object-fit: cover;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .event-carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 10;
        }

        .event-carousel-nav:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .event-carousel-nav.prev {
            left: 8px;
        }

        .event-carousel-nav.next {
            right: 8px;
        }

        .event-carousel-nav svg {
            width: 16px;
            height: 16px;
        }

        .event-carousel-indicators {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }

        .event-carousel-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.2s;
        }

        .event-carousel-indicator.active {
            background: white;
            width: 24px;
            border-radius: 4px;
        }

        .event-carousel-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #94a3b8;
            font-size: 14px;
        }

        .event-card-header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .event-ref-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .event-type-prefix {
            font-size: 13px;
            font-weight: 800;
            padding: 6px 10px;
            border-radius: 6px;
            letter-spacing: 0.8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .event-type-prefix.lo {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
        }

        .event-type-prefix.np {
            background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);
            color: white;
        }

        .event-ref-text {
            font-size: 14px;
            font-weight: 700;
            color: #e2e8f0;
        }

        .event-type-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .event-type-badge.imovel {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .event-type-badge.movel {
            background: rgba(139, 92, 246, 0.15);
            color: #8b5cf6;
        }

        .event-type-badge svg {
            width: 14px;
            height: 14px;
        }

        .event-card-body {
            padding: 10px;
        }

        .event-section {
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f1f5f9;
        }

        .card-actions {
            display: flex;
            gap: 6px;
            padding: 8px 10px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .card-action-btn {
            flex: 1;
            padding: 8px;
            border: 1.5px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
        }

        .card-action-btn:hover {
            background: #6366f1;
            border-color: #6366f1;
            color: white;
            transform: translateY(-1px);
        }

        .card-action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f1f5f9;
        }

        .card-action-btn:disabled:hover {
            background: #f1f5f9;
            border-color: #e2e8f0;
            color: #94a3b8;
            transform: none;
        }

        .card-action-btn svg {
            width: 14px;
            height: 14px;
        }

        .event-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-title {
            font-size: 10px;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .section-title svg {
            width: 12px;
            height: 12px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: start;
            padding: 4px 0;
            gap: 8px;
        }

        .detail-label {
            color: #64748b;
            font-size: 11px;
            font-weight: 500;
            flex-shrink: 0;
        }

        .detail-value {
            color: #0f172a;
            font-size: 11px;
            font-weight: 600;
            text-align: right;
            word-break: break-word;
        }

        .detail-value.empty {
            color: #cbd5e1;
            font-style: italic;
        }

        .detail-value.price {
            color: #16a34a;
            font-size: 15px;
            font-weight: 700;
        }

        .detail-value.date {
            color: #ea580c;
            font-weight: 600;
        }

        /* Loading & Empty States */
        .loading {
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e2e8f0;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }

        .no-data {
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .no-data-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            color: #cbd5e1;
        }

        .no-data-text {
            color: #64748b;
            font-size: 16px;
            font-weight: 500;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 32px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .pagination button {
            padding: 10px 20px;
            border: 1.5px solid #e2e8f0;
            background: white;
            color: #475569;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .pagination button:hover:not(:disabled) {
            background: #f8fafc;
            border-color: #6366f1;
            color: #6366f1;
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination button svg {
            width: 16px;
            height: 16px;
        }

        .page-info {
            padding: 0 16px;
            font-weight: 600;
            color: #0f172a;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 220px;
            }

            .main-content {
                margin-left: 220px;
                width: calc(100% - 220px);
            }

            .events-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }

            .events-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                flex-direction: column;
                gap: 0;
                padding: 8px;
            }

            .stats-bar-item {
                padding: 12px;
                border-bottom: 1px solid #e2e8f0;
            }

            .stats-bar-item:last-child {
                border-bottom: none;
            }

            .stats-bar-divider {
                display: none;
            }

            .filters-bar {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
                min-width: 0;
            }
        }

        /* Multi-Stage Controls */
        .stage-control {
            margin-bottom: 16px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .stage-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stage-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
        }

        .stage-badge.stage-1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stage-badge.stage-2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stage-badge.stage-3 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stage-result {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            padding: 4px 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .stage-result.success {
            color: #16a34a;
            border-color: #86efac;
            background: #dcfce7;
        }

        .stage-result.loading {
            color: #0284c7;
            border-color: #7dd3fc;
            background: #e0f2fe;
        }

        .stage-controls {
            display: flex;
            gap: 8px;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .stage-controls textarea {
            resize: vertical;
            flex: 1;
            min-width: 200px;
        }

        /* ===== PIPELINE ANIMATIONS ===== */

        /* Animated gradient flow in progress line */
        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        #pipeline-progress-line {
            background: linear-gradient(90deg,
                #3b82f6 0%,
                #8b5cf6 25%,
                #ec4899 50%,
                #8b5cf6 75%,
                #3b82f6 100%) !important;
            background-size: 200% 100% !important;
            animation: gradientFlow 3s ease infinite;
        }

        /* Pipeline stage pulse effect when active */
        .pipeline-stage {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .pipeline-stage.stage-active {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(59, 130, 246, 0);
            }
        }

        /* Flow particles animation */
        @keyframes flowParticle {
            0% {
                left: 0%;
                opacity: 0;
            }
            25% {
                opacity: 1;
            }
            75% {
                opacity: 1;
            }
            100% {
                left: 100%;
                opacity: 0;
            }
        }

        /* Shimmer effect for status badges */
        @keyframes shimmer {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        .status-badge-running {
            position: relative;
            overflow: hidden;
        }

        .status-badge-running::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent);
            animation: shimmer 2s infinite;
        }

        /* Success checkmark bounce */
        @keyframes successBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .status-badge-success {
            animation: successBounce 0.6s ease;
        }

        /* Error shake animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .status-badge-error {
            animation: shake 0.4s ease;
        }

        /* Stat icon subtle rotation on hover */
        .stat-icon {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card:hover .stat-icon {
            transform: rotate(5deg) scale(1.1);
        }

        /* Fade in up animation for event cards */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .event-card {
            animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) backwards;
        }

        /* Staggered animation delay for cards */
        .event-card:nth-child(1) { animation-delay: 0.05s; }
        .event-card:nth-child(2) { animation-delay: 0.1s; }
        .event-card:nth-child(3) { animation-delay: 0.15s; }
        .event-card:nth-child(4) { animation-delay: 0.2s; }
        .event-card:nth-child(5) { animation-delay: 0.25s; }
        .event-card:nth-child(6) { animation-delay: 0.3s; }

        /* Loading skeleton shimmer */
        @keyframes loadingSkeleton {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton {
            background: linear-gradient(
                90deg,
                #f0f0f0 25%,
                #e0e0e0 50%,
                #f0f0f0 75%
            );
            background-size: 200% 100%;
            animation: loadingSkeleton 1.5s infinite;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="width: 24px; height: 24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                <span>E-Leil√µes</span>
            </h1>
            <p>Sistema de Gest√£o</p>
        </div>

        <nav class="sidebar-nav">
            <!-- MAIN -->
            <div class="nav-section-label">Main</div>
            <div class="nav-item active" onclick="showPage('dashboard')" data-page="dashboard">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <span>Dashboard</span>
            </div>

            <div class="nav-divider"></div>

            <!-- EVENTS -->
            <div class="nav-section-label">Events</div>
            <div class="nav-item" onclick="showPage('imoveis')" data-page="imoveis">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <span>Im√≥veis</span>
            </div>
            <div class="nav-item" onclick="showPage('veiculos')" data-page="veiculos">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/>
                </svg>
                <span>Ve√≠culos</span>
            </div>
            <div class="nav-item" onclick="showPage('direitos')" data-page="direitos">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <span>Direitos</span>
            </div>
            <div class="nav-item" onclick="showPage('equipamentos')" data-page="equipamentos">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span>Equipamentos</span>
            </div>
            <div class="nav-item" onclick="showPage('mobiliario')" data-page="mobiliario">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                </svg>
                <span>Mobili√°rio</span>
            </div>
            <div class="nav-item" onclick="showPage('maquinas')" data-page="maquinas">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                </svg>
                <span>M√°quinas</span>
            </div>

            <div class="nav-divider"></div>

            <!-- TOOLS -->
            <div class="nav-section-label">Tools</div>
            <div class="nav-item" onclick="scrollToPipelines()">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                <span>Scrapers</span>
            </div>
        </nav>

        <!-- Bottom Section -->
        <div class="sidebar-bottom">
            <!-- User Card -->
            <div class="user-card" id="userCard" onclick="toggleUserDropdown()">
                <div class="user-card-header">
                    <div class="user-card-avatar">JD</div>
                    <div class="user-card-info">
                        <span class="user-card-name">John Doe</span>
                        <span class="user-card-email">john@example.com</span>
                    </div>
                    <svg class="user-card-toggle" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                    </svg>
                </div>
                <div class="user-card-dropdown">
                    <div class="user-dropdown-item" onclick="event.stopPropagation()">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span>Profile</span>
                    </div>
                    <div class="user-dropdown-item logout" onclick="event.stopPropagation()">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        <span>Logout</span>
                    </div>
                </div>
            </div>

            <div class="nav-divider"></div>
            <div class="nav-item" onclick="openSettings()">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span>Settings</span>
            </div>
            <div class="nav-item" onclick="toggleSidebarLock()">
                <svg id="lockIcon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
                </svg>
                <span>Lock Sidebar</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <!-- Stats Container - Total on left, 2x3 grid on right -->
            <div class="stats-container">
                <!-- Total Card -->
                <div class="stats-total-card">
                    <div class="stats-total-icon">üì¶</div>
                    <span class="stats-total-value" id="stat-total">0</span>
                    <span class="stats-total-label">Total</span>
                    <div class="stats-total-breakdown">
                        <span><span class="lo" id="stat-total-lo">0</span> LO</span>
                        <span><span class="np" id="stat-total-np">0</span> NP</span>
                    </div>
                </div>

                <!-- 2x3 Grid of Event Types -->
                <div class="stats-grid">
                    <!-- Row 1 -->
                    <div class="stats-card">
                        <button class="stats-card-view-btn" onclick="showPage('imoveis')" title="Ver Im√≥veis">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        </button>
                        <div class="stats-card-header">
                            <div class="stats-card-icon green">üè†</div>
                            <div class="stats-card-info">
                                <span class="stats-card-value" id="stat-imoveis">0</span>
                                <span class="stats-card-label">Im√≥veis</span>
                            </div>
                        </div>
                        <div class="stats-card-breakdown">
                            <span><span class="lo" id="stat-imoveis-lo">0</span> LO</span>
                            <span><span class="np" id="stat-imoveis-np">0</span> NP</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <button class="stats-card-view-btn" onclick="showPage('veiculos')" title="Ver Ve√≠culos">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        </button>
                        <div class="stats-card-header">
                            <div class="stats-card-icon purple">üöó</div>
                            <div class="stats-card-info">
                                <span class="stats-card-value" id="stat-veiculos">0</span>
                                <span class="stats-card-label">Ve√≠culos</span>
                            </div>
                        </div>
                        <div class="stats-card-breakdown">
                            <span><span class="lo" id="stat-veiculos-lo">0</span> LO</span>
                            <span><span class="np" id="stat-veiculos-np">0</span> NP</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <button class="stats-card-view-btn" onclick="showPage('direitos')" title="Ver Direitos">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        </button>
                        <div class="stats-card-header">
                            <div class="stats-card-icon orange">üìú</div>
                            <div class="stats-card-info">
                                <span class="stats-card-value" id="stat-direitos">0</span>
                                <span class="stats-card-label">Direitos</span>
                            </div>
                        </div>
                        <div class="stats-card-breakdown">
                            <span><span class="lo" id="stat-direitos-lo">0</span> LO</span>
                            <span><span class="np" id="stat-direitos-np">0</span> NP</span>
                        </div>
                    </div>
                    <!-- Row 2 -->
                    <div class="stats-card">
                        <button class="stats-card-view-btn" onclick="showPage('equipamentos')" title="Ver Equipamentos">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        </button>
                        <div class="stats-card-header">
                            <div class="stats-card-icon cyan">üîß</div>
                            <div class="stats-card-info">
                                <span class="stats-card-value" id="stat-equipamentos">0</span>
                                <span class="stats-card-label">Equipamentos</span>
                            </div>
                        </div>
                        <div class="stats-card-breakdown">
                            <span><span class="lo" id="stat-equipamentos-lo">0</span> LO</span>
                            <span><span class="np" id="stat-equipamentos-np">0</span> NP</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <button class="stats-card-view-btn" onclick="showPage('mobiliario')" title="Ver Mobili√°rio">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        </button>
                        <div class="stats-card-header">
                            <div class="stats-card-icon yellow">ü™ë</div>
                            <div class="stats-card-info">
                                <span class="stats-card-value" id="stat-mobiliario">0</span>
                                <span class="stats-card-label">Mobili√°rio</span>
                            </div>
                        </div>
                        <div class="stats-card-breakdown">
                            <span><span class="lo" id="stat-mobiliario-lo">0</span> LO</span>
                            <span><span class="np" id="stat-mobiliario-np">0</span> NP</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <button class="stats-card-view-btn" onclick="showPage('maquinas')" title="Ver M√°quinas">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        </button>
                        <div class="stats-card-header">
                            <div class="stats-card-icon red">‚öôÔ∏è</div>
                            <div class="stats-card-info">
                                <span class="stats-card-value" id="stat-maquinas">0</span>
                                <span class="stats-card-label">M√°quinas</span>
                            </div>
                        </div>
                        <div class="stats-card-breakdown">
                            <span><span class="lo" id="stat-maquinas-lo">0</span> LO</span>
                            <span><span class="np" id="stat-maquinas-np">0</span> NP</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="dashboard-content">
                <!-- ========== SCRAPERS INDEPENDENTES - 3 DESIGN OPTIONS ========== -->
                <!-- Design switcher (temporary - remove after choosing) -->
                <div style="margin-bottom: 8px; display: flex; gap: 4px; justify-content: flex-end;">
                    <button onclick="switchScraperDesign('a')" class="design-opt-btn" data-design="a" style="padding: 4px 10px; font-size: 10px; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; background: #6366f1; color: white;">A</button>
                    <button onclick="switchScraperDesign('b')" class="design-opt-btn" data-design="b" style="padding: 4px 10px; font-size: 10px; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; background: #f8fafc;">B</button>
                    <button onclick="switchScraperDesign('c')" class="design-opt-btn" data-design="c" style="padding: 4px 10px; font-size: 10px; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; background: #f8fafc;">C</button>
                </div>

                <!-- ===== DESIGN A: Tabs + Cards ===== -->
                <div id="scraper-design-a" class="scraper-control-card" style="margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                        <h3 style="font-size: 14px; margin: 0; display: flex; align-items: center; gap: 8px;">
                            <span style="width: 28px; height: 28px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 6px; display: flex; align-items: center; justify-content: center;">üõ†Ô∏è</span>
                            Scrapers Independentes
                        </h3>
                        <select class="filter-select" id="independent-tipo-a" style="padding: 6px 10px; font-size: 11px; min-width: 130px;">
                            <option value="">üì¶ Todos os Tipos</option>
                            <option value="1">üè† Im√≥veis</option>
                            <option value="2">üöó Ve√≠culos</option>
                            <option value="3">üìú Direitos</option>
                            <option value="4">üîß Equipamentos</option>
                            <option value="5">ü™ë Mobili√°rio</option>
                            <option value="6">‚öôÔ∏è M√°quinas</option>
                        </select>
                    </div>

                    <!-- Tabs -->
                    <div style="display: flex; gap: 4px; margin-bottom: 16px; background: #f1f5f9; padding: 4px; border-radius: 8px;">
                        <button onclick="switchScraperTab('ids')" class="scraper-tab active" data-tab="ids" style="flex: 1; padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: white; color: #1e293b; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">üîç Recolher IDs</button>
                        <button onclick="switchScraperTab('process')" class="scraper-tab" data-tab="process" style="flex: 1; padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: transparent; color: #64748b;">üìã Processar</button>
                    </div>

                    <!-- Tab Content: IDs -->
                    <div id="tab-ids" class="tab-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <!-- Card: Todos -->
                            <div onclick="runIndependentScraper('ids')" style="padding: 16px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 1px solid #bfdbfe; border-radius: 10px; cursor: pointer; transition: all 0.2s; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.2)'" onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                <div style="font-size: 24px; margin-bottom: 8px;">üåê</div>
                                <div style="font-size: 13px; font-weight: 600; color: #1e40af;">Todos os IDs</div>
                                <div style="font-size: 11px; color: #3b82f6; margin-top: 4px;">Scrape completo</div>
                            </div>
                            <!-- Card: Espec√≠ficos -->
                            <div onclick="document.getElementById('specific-ids-input').focus()" style="padding: 16px; background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); border: 1px solid #c4b5fd; border-radius: 10px; cursor: pointer; transition: all 0.2s; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(139,92,246,0.2)'" onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                <div style="font-size: 24px; margin-bottom: 8px;">üéØ</div>
                                <div style="font-size: 13px; font-weight: 600; color: #5b21b6;">IDs Espec√≠ficos</div>
                                <div style="font-size: 11px; color: #8b5cf6; margin-top: 4px;">Lista personalizada</div>
                            </div>
                        </div>
                        <!-- Input for specific IDs -->
                        <div style="margin-top: 12px;">
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="specific-ids-input" placeholder="LO-2024-001, NP-2024-002..." style="flex: 1; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px; outline: none; transition: border 0.2s;" onfocus="this.style.borderColor='#6366f1'" onblur="this.style.borderColor='#e2e8f0'">
                                <button onclick="runSpecificIds()" style="padding: 10px 16px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform=''">Executar</button>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Content: Process -->
                    <div id="tab-process" class="tab-content" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <button onclick="runIndependentScraper('content')" style="padding: 16px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 1px solid #6ee7b7; border-radius: 10px; cursor: pointer; transition: all 0.2s; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(16,185,129,0.2)'" onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                <div style="font-size: 24px; margin-bottom: 8px;">üìã</div>
                                <div style="font-size: 13px; font-weight: 600; color: #047857;">Conte√∫do</div>
                                <div style="font-size: 11px; color: #10b981; margin-top: 4px;">Detalhes dos eventos</div>
                            </button>
                            <button onclick="runIndependentScraper('images')" style="padding: 16px; background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%); border: 1px solid #fdba74; border-radius: 10px; cursor: pointer; transition: all 0.2s; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(251,146,60,0.2)'" onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                <div style="font-size: 24px; margin-bottom: 8px;">üñºÔ∏è</div>
                                <div style="font-size: 13px; font-weight: 600; color: #c2410c;">Imagens</div>
                                <div style="font-size: 11px; color: #f97316; margin-top: 4px;">Download de fotos</div>
                            </button>
                        </div>
                    </div>

                    <!-- IDs Results Section -->
                    <div id="ids-results-section-a" style="display: none; margin-top: 16px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 1px solid #86efac; border-radius: 10px 10px 0 0;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 13px; font-weight: 600; color: #166534;">‚úì IDs Recolhidos</span>
                                <span id="ids-count-badge-a" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">0</span>
                            </div>
                            <div style="display: flex; gap: 6px;">
                                <button onclick="copyIdsToClipboard()" style="padding: 5px 10px; font-size: 11px; background: white; border: 1px solid #86efac; border-radius: 6px; cursor: pointer; color: #166534; font-weight: 500;">üìã Copiar</button>
                                <button onclick="clearCollectedIds()" style="padding: 5px 10px; font-size: 11px; background: white; border: 1px solid #fca5a5; border-radius: 6px; cursor: pointer; color: #dc2626; font-weight: 500;">‚úï</button>
                            </div>
                        </div>
                        <div id="ids-results-list-a" style="max-height: 180px; overflow-y: auto; background: #fafafa; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 10px 10px; padding: 10px;"></div>
                    </div>
                </div>

                <!-- ===== DESIGN B: Compact Inline ===== -->
                <div id="scraper-design-b" class="scraper-control-card" style="margin-bottom: 16px; display: none;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #0ea5e9, #06b6d4); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px;">üõ†Ô∏è</div>
                        <div style="flex: 1;">
                            <h3 style="font-size: 14px; margin: 0; color: #1e293b;">Scrapers Independentes</h3>
                            <p style="font-size: 11px; color: #64748b; margin: 2px 0 0 0;">Executar opera√ß√µes individuais</p>
                        </div>
                        <select class="filter-select" id="independent-tipo-b" style="padding: 8px 12px; font-size: 11px; min-width: 130px; border-radius: 8px;">
                            <option value="">üì¶ Todos</option>
                            <option value="1">üè† Im√≥veis</option>
                            <option value="2">üöó Ve√≠culos</option>
                            <option value="3">üìú Direitos</option>
                            <option value="4">üîß Equipamentos</option>
                            <option value="5">ü™ë Mobili√°rio</option>
                            <option value="6">‚öôÔ∏è M√°quinas</option>
                        </select>
                    </div>

                    <!-- Segmented Actions -->
                    <div style="background: #f8fafc; border-radius: 10px; padding: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <span style="font-size: 11px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">IDs:</span>
                            <button onclick="runIndependentScraper('ids')" style="padding: 7px 14px; background: #0ea5e9; color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                <span>üåê</span> Todos
                            </button>
                            <div style="flex: 1; display: flex; gap: 6px;">
                                <input type="text" id="specific-ids-input-b" placeholder="IDs espec√≠ficos..." style="flex: 1; padding: 7px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 11px;">
                                <button onclick="runSpecificIdsB()" style="padding: 7px 12px; background: #8b5cf6; color: white; border: none; border-radius: 6px; font-size: 11px; cursor: pointer;">üéØ</button>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 11px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Processar:</span>
                            <button onclick="runIndependentScraper('content')" style="padding: 7px 14px; background: #10b981; color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                <span>üìã</span> Conte√∫do
                            </button>
                            <button onclick="runIndependentScraper('images')" style="padding: 7px 14px; background: #f97316; color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                <span>üñºÔ∏è</span> Imagens
                            </button>
                        </div>
                    </div>

                    <!-- IDs Results -->
                    <div id="ids-results-section-b" style="display: none; margin-top: 12px; background: #ecfdf5; border-radius: 8px; padding: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 12px; font-weight: 600; color: #166534;">‚úì <span id="ids-count-badge-b">0</span> IDs recolhidos</span>
                            <div style="display: flex; gap: 4px;">
                                <button onclick="copyIdsToClipboard()" style="padding: 4px 8px; font-size: 10px; background: white; border: 1px solid #86efac; border-radius: 4px; cursor: pointer;">üìã</button>
                                <button onclick="clearCollectedIds()" style="padding: 4px 8px; font-size: 10px; background: white; border: 1px solid #fca5a5; border-radius: 4px; cursor: pointer;">‚úï</button>
                            </div>
                        </div>
                        <div id="ids-results-list-b" style="max-height: 150px; overflow-y: auto; background: white; border-radius: 6px; padding: 8px;"></div>
                    </div>
                </div>

                <!-- ===== DESIGN C: Minimal Cards ===== -->
                <div id="scraper-design-c" class="scraper-control-card" style="margin-bottom: 16px; display: none; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                        <h3 style="font-size: 14px; margin: 0; display: flex; align-items: center; gap: 10px; color: white;">
                            <span style="font-size: 20px;">üõ†Ô∏è</span>
                            Scrapers
                        </h3>
                        <select id="independent-tipo-c" style="padding: 8px 12px; font-size: 11px; min-width: 120px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
                            <option value="" style="color: #1e293b;">üì¶ Todos</option>
                            <option value="1" style="color: #1e293b;">üè† Im√≥veis</option>
                            <option value="2" style="color: #1e293b;">üöó Ve√≠culos</option>
                            <option value="3" style="color: #1e293b;">üìú Direitos</option>
                            <option value="4" style="color: #1e293b;">üîß Equipamentos</option>
                            <option value="5" style="color: #1e293b;">ü™ë Mobili√°rio</option>
                            <option value="6" style="color: #1e293b;">‚öôÔ∏è M√°quinas</option>
                        </select>
                    </div>

                    <!-- Action Grid -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 12px;">
                        <button onclick="runIndependentScraper('ids')" style="padding: 14px 8px; background: rgba(99, 102, 241, 0.2); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.background='rgba(99, 102, 241, 0.3)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.2)'">
                            <div style="font-size: 20px; margin-bottom: 4px;">üåê</div>
                            <div style="font-size: 11px; color: #a5b4fc; font-weight: 500;">All IDs</div>
                        </button>
                        <button onclick="showSpecificIdsInput()" style="padding: 14px 8px; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.4); border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.3)'" onmouseout="this.style.background='rgba(139, 92, 246, 0.2)'">
                            <div style="font-size: 20px; margin-bottom: 4px;">üéØ</div>
                            <div style="font-size: 11px; color: #c4b5fd; font-weight: 500;">Specific</div>
                        </button>
                        <button onclick="runIndependentScraper('content')" style="padding: 14px 8px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.background='rgba(16, 185, 129, 0.3)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.2)'">
                            <div style="font-size: 20px; margin-bottom: 4px;">üìã</div>
                            <div style="font-size: 11px; color: #6ee7b7; font-weight: 500;">Content</div>
                        </button>
                        <button onclick="runIndependentScraper('images')" style="padding: 14px 8px; background: rgba(249, 115, 22, 0.2); border: 1px solid rgba(249, 115, 22, 0.4); border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.background='rgba(249, 115, 22, 0.3)'" onmouseout="this.style.background='rgba(249, 115, 22, 0.2)'">
                            <div style="font-size: 20px; margin-bottom: 4px;">üñºÔ∏è</div>
                            <div style="font-size: 11px; color: #fdba74; font-weight: 500;">Images</div>
                        </button>
                    </div>

                    <!-- Specific IDs Input (hidden by default) -->
                    <div id="specific-ids-panel-c" style="display: none; margin-bottom: 12px;">
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="specific-ids-input-c" placeholder="LO-2024-001, NP-2024-002..." style="flex: 1; padding: 10px 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-size: 12px; color: white; outline: none;" onfocus="this.style.borderColor='#8b5cf6'" onblur="this.style.borderColor='rgba(255,255,255,0.2)'">
                            <button onclick="runSpecificIdsC()" style="padding: 10px 16px; background: #8b5cf6; color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 500; cursor: pointer;">Run</button>
                        </div>
                    </div>

                    <!-- IDs Results -->
                    <div id="ids-results-section-c" style="display: none; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 12px; color: #86efac;">‚úì <span id="ids-count-badge-c" style="font-weight: 600;">0</span> IDs</span>
                            <div style="display: flex; gap: 4px;">
                                <button onclick="copyIdsToClipboard()" style="padding: 4px 8px; font-size: 10px; background: rgba(255,255,255,0.1); border: none; border-radius: 4px; cursor: pointer; color: white;">üìã</button>
                                <button onclick="clearCollectedIds()" style="padding: 4px 8px; font-size: 10px; background: rgba(255,255,255,0.1); border: none; border-radius: 4px; cursor: pointer; color: white;">‚úï</button>
                            </div>
                        </div>
                        <div id="ids-results-list-c" style="max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 6px; padding: 8px;"></div>
                    </div>
                </div>

                <!-- Pipelines Autom√°ticas - Tabela -->
                <div class="scraper-control-card" style="margin-bottom: 16px;">
                    <div class="scraper-control-header" style="margin-bottom: 12px;">
                        <h3 style="font-size: 14px; margin: 0;">‚ö° Pipelines Autom√°ticas</h3>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #e2e8f0;">
                                <th style="text-align: left; padding: 8px; color: #64748b; font-weight: 600;">Pipeline</th>
                                <th style="text-align: center; padding: 8px; color: #64748b; font-weight: 600;">Intervalo</th>
                                <th style="text-align: center; padding: 8px; color: #64748b; font-weight: 600;">Target</th>
                                <th style="text-align: right; padding: 8px; color: #64748b; font-weight: 600;">Ativo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #f1f5f9;">
                                <td style="padding: 10px 8px;"><span style="margin-right: 6px;">ü§ñ</span>Auto Pipeline</td>
                                <td style="text-align: center; padding: 10px 8px; color: #64748b;">8 horas</td>
                                <td style="text-align: center; padding: 10px 8px; color: #64748b;">Todos</td>
                                <td style="text-align: right; padding: 10px 8px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-pipeline-full" onchange="toggleAutoPipeline('full', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f1f5f9; background: #fef2f2;">
                                <td style="padding: 10px 8px; color: #dc2626; font-weight: 500;"><span style="margin-right: 6px;">üî¥</span>X-Critical</td>
                                <td style="text-align: center; padding: 10px 8px; color: #dc2626; font-weight: 600;">5 seg</td>
                                <td style="text-align: center; padding: 10px 8px; color: #dc2626;">< 5 min</td>
                                <td style="text-align: right; padding: 10px 8px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-pipeline-prices" onchange="toggleAutoPipeline('prices', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f1f5f9; background: #fff7ed;">
                                <td style="padding: 10px 8px; color: #ea580c; font-weight: 500;"><span style="margin-right: 6px;">üü†</span>X-Urgent</td>
                                <td style="text-align: center; padding: 10px 8px; color: #ea580c; font-weight: 600;">1 min</td>
                                <td style="text-align: center; padding: 10px 8px; color: #ea580c;">< 1 hora</td>
                                <td style="text-align: right; padding: 10px 8px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-pipeline-prices_urgent" onchange="toggleAutoPipeline('prices_urgent', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f1f5f9; background: #fefce8;">
                                <td style="padding: 10px 8px; color: #ca8a04; font-weight: 500;"><span style="margin-right: 6px;">üü°</span>X-Soon</td>
                                <td style="text-align: center; padding: 10px 8px; color: #ca8a04; font-weight: 600;">10 min</td>
                                <td style="text-align: center; padding: 10px 8px; color: #ca8a04;">< 24h</td>
                                <td style="text-align: right; padding: 10px 8px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-pipeline-prices_soon" onchange="toggleAutoPipeline('prices_soon', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 10px 8px;"><span style="margin-right: 6px;">üîÑ</span>Y-Info</td>
                                <td style="text-align: center; padding: 10px 8px; color: #64748b;">2 horas</td>
                                <td style="text-align: center; padding: 10px 8px; color: #64748b;">Todos</td>
                                <td style="text-align: right; padding: 10px 8px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-pipeline-info" onchange="toggleAutoPipeline('info', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pipeline Completo - Stepper Minimalista -->
                <div class="scraper-control-card" style="margin-top: 16px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                            <!-- Step 1 -->
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div id="stage1-circle" style="width: 28px; height: 28px; border-radius: 50%; background: #e0e7ff; color: #3b82f6; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; transition: all 0.3s ease;">1</div>
                                <span style="font-size: 13px; font-weight: 500; color: #1e293b;">IDs</span>
                                <span id="stage1-count" style="font-size: 11px; color: #94a3b8; font-weight: 600;"></span>
                            </div>
                            <div id="pipeline-line1" style="flex: 1; height: 2px; background: #e2e8f0; border-radius: 1px; transition: background 0.3s ease;"></div>
                            <!-- Step 2 -->
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div id="stage2-circle" style="width: 28px; height: 28px; border-radius: 50%; background: #f1f5f9; color: #94a3b8; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; transition: all 0.3s ease;">2</div>
                                <span style="font-size: 13px; font-weight: 500; color: #64748b;">Content</span>
                                <span id="stage2-count" style="font-size: 11px; color: #94a3b8; font-weight: 600;"></span>
                            </div>
                            <div id="pipeline-line2" style="flex: 1; height: 2px; background: #e2e8f0; border-radius: 1px; transition: background 0.3s ease;"></div>
                            <!-- Step 3 -->
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div id="stage3-circle" style="width: 28px; height: 28px; border-radius: 50%; background: #f1f5f9; color: #94a3b8; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; transition: all 0.3s ease;">3</div>
                                <span style="font-size: 13px; font-weight: 500; color: #64748b;">Images</span>
                                <span id="stage3-count" style="font-size: 11px; color: #94a3b8; font-weight: 600;"></span>
                            </div>
                        </div>
                        <button class="scraper-btn primary" id="btn-pipeline" onclick="togglePipeline()" style="padding: 10px 20px; font-size: 13px; white-space: nowrap;">
                            ‚ñ∂ Executar
                        </button>
                    </div>
                    <!-- Progress Feedback -->
                    <div id="pipeline-feedback" style="display: none; margin-top: 12px; padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span id="feedback-status" style="font-weight: 600; color: #1e293b; font-size: 13px;">A processar...</span>
                                <span id="feedback-action" style="font-size: 12px; color: #64748b; margin-left: 8px;"></span>
                            </div>
                            <span id="feedback-count" style="font-size: 14px; font-weight: 700; color: #3b82f6;">0 / 0</span>
                        </div>
                        <div style="margin-top: 8px; background: #e2e8f0; border-radius: 4px; height: 4px; overflow: hidden;">
                            <div id="feedback-progress-bar" style="height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                </div>

                <!-- Collapsible Danger Zone -->
                <details class="danger-zone-collapsible" style="margin-top: 16px;">
                    <summary style="cursor: pointer; padding: 12px 16px; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 1px solid #fecaca; border-radius: 8px; font-weight: 600; color: #dc2626; display: flex; align-items: center; gap: 8px; user-select: none;">
                        <span style="transition: transform 0.2s;">‚ñ∂</span> ‚ö†Ô∏è Zona de Perigo
                    </summary>
                    <div style="padding: 16px; background: white; border: 1px solid #fecaca; border-top: none; border-radius: 0 0 8px 8px;">
                        <p style="color: #7f1d1d; font-size: 12px; line-height: 1.5; margin-bottom: 12px;">
                            Esta a√ß√£o ir√° <strong>apagar permanentemente TODOS os eventos</strong> da base de dados.
                        </p>
                        <button class="scraper-btn stop" onclick="confirmClearDatabase()" style="width: auto; padding: 8px 16px; font-size: 12px;">
                            üóëÔ∏è Limpar Base de Dados
                        </button>
                    </div>
                </details>
            </div>
        </div>

        <!-- Im√≥veis Page -->
        <div id="imoveis" class="page">
            <div class="page-header">
                <h2>Im√≥veis</h2>
                <p>Todos os im√≥veis dispon√≠veis em leil√£o</p>
            </div>

            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)">
                    <span>LO</span>
                    <span>Leil√£o Online</span>
                </div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)">
                    <span>NP</span>
                    <span>Negocia√ß√£o Particular</span>
                </div>
            </div>

            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-imoveis" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-imoveis">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="dataInicio_asc">Data in√≠cio: mais antiga</option>
                        <option value="dataInicio_desc">Data in√≠cio: mais recente</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                        <option value="valorMinimo_asc">Valor m√≠nimo: mais baixo</option>
                        <option value="valorMinimo_desc">Valor m√≠nimo: mais alto</option>
                        <option value="lanceAtual_asc">Lance atual: mais baixo</option>
                        <option value="lanceAtual_desc">Lance atual: mais alto</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Distrito</label>
                    <select class="filter-select" id="distrito-imoveis" onchange="updateConcelhoFilter('imoveis')">
                        <option value="">Todos os distritos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Concelho</label>
                    <select class="filter-select" id="concelho-imoveis" onchange="updateFreguesiaFilter('imoveis')" disabled>
                        <option value="">Todos os concelhos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Freguesia</label>
                    <select class="filter-select" id="freguesia-imoveis" disabled>
                        <option value="">Todas as freguesias</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="reloadAllData('imoveis')">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Atualizar
                    </button>
                    <button class="btn btn-secondary" onclick="clearFilters('imoveis')">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                        Limpar
                    </button>
                </div>
            </div>

            <div id="imoveis-content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">A carregar im√≥veis...</div>
                </div>
            </div>

            <div id="pagination-imoveis" class="pagination" style="display: none;"></div>
        </div>

        <!-- Ve√≠culos Page -->
        <div id="veiculos" class="page">
            <div class="page-header">
                <h2>Ve√≠culos</h2>
                <p>Todos os ve√≠culos dispon√≠veis em leil√£o</p>
            </div>
            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)"><span>LO</span><span>Leil√£o Online</span></div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)"><span>NP</span><span>Negocia√ß√£o Particular</span></div>
            </div>
            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-veiculos" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-veiculos">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="reloadAllData('veiculos')">üîÑ Atualizar</button>
                    <button class="btn btn-secondary" onclick="clearFilters('veiculos')">‚úï Limpar</button>
                </div>
            </div>
            <div id="veiculos-content"><div class="loading"><div class="loading-spinner"></div><div class="loading-text">A carregar ve√≠culos...</div></div></div>
            <div id="pagination-veiculos" class="pagination" style="display: none;"></div>
        </div>

        <!-- Direitos Page -->
        <div id="direitos" class="page">
            <div class="page-header">
                <h2>Direitos</h2>
                <p>Todos os direitos dispon√≠veis em leil√£o</p>
            </div>
            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)"><span>LO</span><span>Leil√£o Online</span></div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)"><span>NP</span><span>Negocia√ß√£o Particular</span></div>
            </div>
            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-direitos" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-direitos">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="reloadAllData('direitos')">üîÑ Atualizar</button>
                    <button class="btn btn-secondary" onclick="clearFilters('direitos')">‚úï Limpar</button>
                </div>
            </div>
            <div id="direitos-content"><div class="loading"><div class="loading-spinner"></div><div class="loading-text">A carregar direitos...</div></div></div>
            <div id="pagination-direitos" class="pagination" style="display: none;"></div>
        </div>

        <!-- Equipamentos Page -->
        <div id="equipamentos" class="page">
            <div class="page-header">
                <h2>Equipamentos</h2>
                <p>Todos os equipamentos dispon√≠veis em leil√£o</p>
            </div>
            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)"><span>LO</span><span>Leil√£o Online</span></div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)"><span>NP</span><span>Negocia√ß√£o Particular</span></div>
            </div>
            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-equipamentos" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-equipamentos">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="reloadAllData('equipamentos')">üîÑ Atualizar</button>
                    <button class="btn btn-secondary" onclick="clearFilters('equipamentos')">‚úï Limpar</button>
                </div>
            </div>
            <div id="equipamentos-content"><div class="loading"><div class="loading-spinner"></div><div class="loading-text">A carregar equipamentos...</div></div></div>
            <div id="pagination-equipamentos" class="pagination" style="display: none;"></div>
        </div>

        <!-- Mobili√°rio Page -->
        <div id="mobiliario" class="page">
            <div class="page-header">
                <h2>Mobili√°rio</h2>
                <p>Todo o mobili√°rio dispon√≠vel em leil√£o</p>
            </div>
            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)"><span>LO</span><span>Leil√£o Online</span></div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)"><span>NP</span><span>Negocia√ß√£o Particular</span></div>
            </div>
            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-mobiliario" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-mobiliario">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="reloadAllData('mobiliario')">üîÑ Atualizar</button>
                    <button class="btn btn-secondary" onclick="clearFilters('mobiliario')">‚úï Limpar</button>
                </div>
            </div>
            <div id="mobiliario-content"><div class="loading"><div class="loading-spinner"></div><div class="loading-text">A carregar mobili√°rio...</div></div></div>
            <div id="pagination-mobiliario" class="pagination" style="display: none;"></div>
        </div>

        <!-- M√°quinas Page -->
        <div id="maquinas" class="page">
            <div class="page-header">
                <h2>M√°quinas</h2>
                <p>Todas as m√°quinas dispon√≠veis em leil√£o</p>
            </div>
            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)"><span>LO</span><span>Leil√£o Online</span></div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)"><span>NP</span><span>Negocia√ß√£o Particular</span></div>
            </div>
            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-maquinas" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-maquinas">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="reloadAllData('maquinas')">üîÑ Atualizar</button>
                    <button class="btn btn-secondary" onclick="clearFilters('maquinas')">‚úï Limpar</button>
                </div>
            </div>
            <div id="maquinas-content"><div class="loading"><div class="loading-spinner"></div><div class="loading-text">A carregar m√°quinas...</div></div></div>
            <div id="pagination-maquinas" class="pagination" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentPageData = { imoveis: 1, veiculos: 1, direitos: 1, equipamentos: 1, mobiliario: 1, maquinas: 1 };
        let totalPagesData = { imoveis: 1, veiculos: 1, direitos: 1, equipamentos: 1, mobiliario: 1, maquinas: 1 };
        let allDistritos = new Set();
        let activeTypeFilter = null;
        let allLoadedEvents = {
            imoveis: [],
            veiculos: [],
            direitos: [],
            equipamentos: [],
            mobiliario: [],
            maquinas: []
        }; // Store all loaded events
        let filteredEvents = {
            imoveis: [],
            veiculos: [],
            direitos: [],
            equipamentos: [],
            mobiliario: [],
            maquinas: []
        }; // Store filtered events
        const ITEMS_PER_PAGE = 50;

        // Global variables for console and modals
        let consolePollingInterval = null;
        let autoScroll = true;

        // Pipeline X countdown variables
        let pipelineXCountdown = 5;
        let pipelineXCountdownInterval = null;
        let pipelineXCachedEvents = 0;
        let deleteTimerInterval = null;

        // Manual Pipeline control variables
        let pipelineRunning = false;
        let pipelineAbortController = null;

        // Sidebar Lock
        function toggleSidebarLock() {
            const sidebar = document.getElementById('sidebar');
            const lockIcon = document.getElementById('lockIcon');
            const isLocked = sidebar.classList.contains('locked');

            if (isLocked) {
                sidebar.classList.remove('locked');
                lockIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>';
                localStorage.setItem('sidebarLocked', 'false');
            } else {
                sidebar.classList.add('locked');
                lockIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>';
                localStorage.setItem('sidebarLocked', 'true');
            }
        }

        // User Card Dropdown Toggle
        function toggleUserDropdown() {
            const userCard = document.getElementById('userCard');
            userCard.classList.toggle('open');
        }

        // Restore sidebar state on load
        function restoreSidebarState() {
            const isLocked = localStorage.getItem('sidebarLocked') === 'true';
            if (isLocked) {
                document.getElementById('sidebar').classList.add('locked');
                document.getElementById('lockIcon').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>';
            }
        }

        // Close dropdowns when sidebar collapses
        document.getElementById('sidebar').addEventListener('mouseleave', function() {
            if (!this.classList.contains('locked')) {
                document.querySelectorAll('.nav-item.dropdown-open').forEach(item => {
                    item.classList.remove('dropdown-open');
                });
                // Also close user card dropdown
                const userCard = document.getElementById('userCard');
                if (userCard) {
                    userCard.classList.remove('open');
                }
            }
        });

        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

            // Show selected page
            document.getElementById(pageId).classList.add('active');

            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

            // Use data-page attribute for more reliable selection
            const navItem = document.querySelector(`.nav-item[data-page="${pageId}"]`) ||
                           document.querySelector(`.nav-item[onclick*="${pageId}"]`);
            if (navItem) navItem.classList.add('active');

            if (pageId === 'dashboard') {
                loadDashboard();
            } else if (['imoveis', 'veiculos', 'direitos', 'equipamentos', 'mobiliario', 'maquinas'].includes(pageId)) {
                loadEvents(pageId);
            }

            // Reset type filter when changing page
            activeTypeFilter = null;
            document.querySelectorAll('.type-badge').forEach(b => b.classList.remove('active'));
        }

        function scrollToPipelines() {
            showPage('dashboard');
            setTimeout(() => {
                const scraperCard = document.querySelector('.dashboard-row');
                if (scraperCard) {
                    scraperCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function openSettings() {
            // TODO: Implement settings modal/page
            alert('Settings - Em breve!');
        }

        function toggleTypeFilter(type, element) {
            if (activeTypeFilter === type) {
                activeTypeFilter = null;
                element.classList.remove('active');
            } else {
                activeTypeFilter = type;
                document.querySelectorAll('.type-badge').forEach(b => b.classList.remove('active'));
                element.classList.add('active');
            }

            // Reload current page
            const activePage = document.querySelector('.page.active').id;
            loadEvents(activePage);
        }

        // Load Dashboard - with auto-refresh
        let statsRefreshInterval = null;

        async function loadDashboard() {
            try {
                await updateDashboardStats();

                // Initialize scraper controls
                initScraperControls();
                // Check scraper status
                updateScraperStatus();

                // Start auto-refresh of stats every 10 seconds
                if (!statsRefreshInterval) {
                    statsRefreshInterval = setInterval(updateDashboardStats, 10000);
                    console.log('üìä Stats auto-refresh started (10s)');
                }
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        async function updateDashboardStats() {
            try {
                // Load ALL events to calculate accurate totals
                const eventsResponse = await fetch(`${API_BASE}/api/events?limit=100000`);
                const eventsData = await eventsResponse.json();

                const events = eventsData.events;
                const total = events.length;

                // Filter by type (supports both old and new format)
                const imoveisEvents = events.filter(e => e.tipoEvento === 'imoveis' || e.tipoEvento === 'imovel');
                const veiculosEvents = events.filter(e => e.tipoEvento === 'veiculos' || e.tipoEvento === 'movel');
                const direitosEvents = events.filter(e => e.tipoEvento === 'direitos');
                const equipamentosEvents = events.filter(e => e.tipoEvento === 'equipamentos');
                const mobiliarioEvents = events.filter(e => e.tipoEvento === 'mobiliario');
                const maquinasEvents = events.filter(e => e.tipoEvento === 'maquinas');

                // Helper function to count LO/NP
                const countLO = (arr) => arr.filter(e => e.reference.startsWith('LO')).length;
                const countNP = (arr) => arr.filter(e => e.reference.startsWith('NP')).length;

                // Total
                document.getElementById('stat-total').textContent = total;
                document.getElementById('stat-total-lo').textContent = countLO(events);
                document.getElementById('stat-total-np').textContent = countNP(events);

                // Im√≥veis
                document.getElementById('stat-imoveis').textContent = imoveisEvents.length;
                document.getElementById('stat-imoveis-lo').textContent = countLO(imoveisEvents);
                document.getElementById('stat-imoveis-np').textContent = countNP(imoveisEvents);

                // Ve√≠culos
                document.getElementById('stat-veiculos').textContent = veiculosEvents.length;
                document.getElementById('stat-veiculos-lo').textContent = countLO(veiculosEvents);
                document.getElementById('stat-veiculos-np').textContent = countNP(veiculosEvents);

                // Direitos
                document.getElementById('stat-direitos').textContent = direitosEvents.length;
                document.getElementById('stat-direitos-lo').textContent = countLO(direitosEvents);
                document.getElementById('stat-direitos-np').textContent = countNP(direitosEvents);

                // Equipamentos
                document.getElementById('stat-equipamentos').textContent = equipamentosEvents.length;
                document.getElementById('stat-equipamentos-lo').textContent = countLO(equipamentosEvents);
                document.getElementById('stat-equipamentos-np').textContent = countNP(equipamentosEvents);

                // Mobili√°rio
                document.getElementById('stat-mobiliario').textContent = mobiliarioEvents.length;
                document.getElementById('stat-mobiliario-lo').textContent = countLO(mobiliarioEvents);
                document.getElementById('stat-mobiliario-np').textContent = countNP(mobiliarioEvents);

                // M√°quinas
                document.getElementById('stat-maquinas').textContent = maquinasEvents.length;
                document.getElementById('stat-maquinas-lo').textContent = countLO(maquinasEvents);
                document.getElementById('stat-maquinas-np').textContent = countNP(maquinasEvents);

            } catch (error) {
                console.error('Erro ao atualizar stats:', error);
            }
        }

        // Scraper Control Functions
        let scraperPollInterval = null;

        function initScraperControls() {
            const btnStart = document.getElementById('btn-start-scraper');
            const btnStop = document.getElementById('btn-stop-scraper');
            const intervalSelect = document.getElementById('scrape-interval');

            btnStart?.addEventListener('click', startScraper);
            btnStop?.addEventListener('click', stopScraper);
            intervalSelect?.addEventListener('change', updateSchedule);
        }

        async function startScraper() {
            try {
                const btnStart = document.getElementById('btn-start-scraper');
                btnStart.disabled = true;
                btnStart.textContent = '‚è≥ A iniciar...';

                const interval = document.getElementById('scrape-interval').value;
                const maxPages = null; // Scrape all pages

                const response = await fetch(`${API_BASE}/scrape/all${maxPages ? '?max_pages=' + maxPages : ''}`, {
                    method: 'POST'
                });

                if (!response.ok) throw new Error('Erro ao iniciar scraper');

                // Update schedule if not manual
                if (interval !== 'manual') {
                    await updateSchedule();
                }

                // Start polling status
                startStatusPolling();

            } catch (error) {
                alert('‚ùå Erro ao iniciar scraper: ' + error.message);
                console.error(error);
                const btnStart = document.getElementById('btn-start-scraper');
                btnStart.disabled = false;
                btnStart.textContent = 'Iniciar';
            }
        }

        async function stopScraper() {
            try {
                const btnStop = document.getElementById('btn-stop-scraper');
                btnStop.disabled = true;
                btnStop.textContent = '‚è≥ A parar...';

                const response = await fetch(`${API_BASE}/scrape/stop`, {
                    method: 'POST'
                });

                if (!response.ok) throw new Error('Erro ao parar scraper');

                stopStatusPolling();
                updateScraperStatus();

            } catch (error) {
                alert('‚ùå Erro ao parar scraper: ' + error.message);
                console.error(error);
                const btnStop = document.getElementById('btn-stop-scraper');
                btnStop.disabled = false;
                btnStop.textContent = 'Parar';
            }
        }

        async function updateSchedule() {
            try {
                const interval = document.getElementById('scrape-interval').value;

                if (interval === 'manual') {
                    // Disable schedule
                    const response = await fetch(`${API_BASE}/scrape/schedule`, {
                        method: 'DELETE'
                    });

                    if (!response.ok && response.status !== 404) {
                        console.warn('Erro ao cancelar agendamento');
                    }
                } else {
                    // Set schedule (use query parameter)
                    const response = await fetch(`${API_BASE}/scrape/schedule?hours=${interval}`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        console.log('Agendamento criado:', data);
                    }
                }
            } catch (error) {
                console.error('Erro ao atualizar schedule:', error);
            }
        }

        function startStatusPolling() {
            if (scraperPollInterval) clearInterval(scraperPollInterval);

            scraperPollInterval = setInterval(updateScraperStatus, 2000);
            updateScraperStatus(); // Update immediately
        }

        function stopStatusPolling() {
            if (scraperPollInterval) {
                clearInterval(scraperPollInterval);
                scraperPollInterval = null;
            }
        }

        async function updateScraperStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/scrape/status`);
                if (!response.ok) return; // Silently fail if endpoint doesn't exist

                const status = await response.json();

                // These elements were removed - skip if not present
                const statusDiv = document.getElementById('scraper-status');
                const statusText = document.getElementById('scraper-status-text');
                const progressDiv = document.getElementById('scraper-progress');
                const progressText = document.getElementById('progress-text');
                const progressCount = document.getElementById('progress-count');
                const progressFill = document.getElementById('progress-bar-fill');
                const btnStart = document.getElementById('btn-start-scraper');
                const btnStop = document.getElementById('btn-stop-scraper');

                if (!statusDiv) return; // Elements don't exist, skip update

                if (status.is_running) {
                    // Scraper is running
                    statusDiv.className = 'scraper-status running';
                    if (statusText) statusText.textContent = 'A correr';
                    if (progressDiv) progressDiv.classList.add('active');
                    if (btnStart) btnStart.disabled = true;
                    if (btnStop) btnStop.disabled = false;

                    // Update progress
                    const processed = status.events_processed || 0;
                    const failed = status.events_failed || 0;
                    const currentPage = status.current_page || 0;

                    if (progressText) progressText.textContent = `P√°gina ${currentPage} ‚Ä¢ ${failed} falhas`;
                    if (progressCount) progressCount.textContent = `${processed} eventos processados`;
                    if (progressFill) progressFill.style.width = '100%'; // Indeterminate progress

                    // Continue polling
                    if (!scraperPollInterval) {
                        startStatusPolling();
                    }
                } else {
                    // Scraper is stopped
                    statusDiv.className = 'scraper-status stopped';
                    if (statusText) statusText.textContent = 'Parado';
                    if (progressDiv) progressDiv.classList.remove('active');
                    if (btnStart) btnStart.disabled = false;
                    if (btnStop) btnStop.disabled = true;

                    // Stop polling
                    stopStatusPolling();

                    // Reload stats if scraper just finished
                    if (status.events_processed > 0) {
                        loadDashboard();
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar status:', error);
                stopStatusPolling();
            }
        }

        // Load Events
        async function loadEvents(type, page = 1) {
            const contentId = `${type}-content`;
            const content = document.getElementById(contentId);

            // Only show loading on first load
            if (allLoadedEvents[type].length === 0) {
                content.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">A carregar ${type}...</div>
                    </div>
                `;
            }

            try {
                // Load ALL events if not already loaded
                if (allLoadedEvents[type].length === 0) {
                    let url = `${API_BASE}/api/events?limit=5000`;
                    url += `&tipo_evento=${type}`;

                    const response = await fetch(url);
                    const data = await response.json();

                    allLoadedEvents[type] = data.events;

                    // Collect distritos
                    if (type === 'imoveis') {
                        data.events.forEach(event => {
                            if (event.detalhes.distrito) {
                                allDistritos.add(event.detalhes.distrito);
                            }
                        });
                        updateDistritoFilter();
                    }
                }

                // Get filter values
                const searchInput = document.getElementById(`search-${type}`);
                const distritoSelect = document.getElementById(`distrito-${type}`);
                const concelhoSelect = document.getElementById(`concelho-${type}`);
                const freguesiaSelect = document.getElementById(`freguesia-${type}`);
                const sortSelect = document.getElementById(`sort-${type}`);

                const search = searchInput ? searchInput.value : '';
                const distrito = distritoSelect ? distritoSelect.value : '';
                const concelho = concelhoSelect ? concelhoSelect.value : '';
                const freguesia = freguesiaSelect ? freguesiaSelect.value : '';
                const sortBy = sortSelect ? sortSelect.value : '';

                // Apply ALL filters to create filtered list
                let events = [...allLoadedEvents[type]];

                if (search) {
                    events = events.filter(e =>
                        e.reference.toLowerCase().includes(search.toLowerCase())
                    );
                }
                if (activeTypeFilter) {
                    events = events.filter(e => e.reference.startsWith(activeTypeFilter));
                }
                if (distrito) {
                    events = events.filter(e => e.detalhes.distrito === distrito);
                }
                if (concelho) {
                    events = events.filter(e => e.detalhes.concelho === concelho);
                }
                if (freguesia) {
                    events = events.filter(e => e.detalhes.freguesia === freguesia);
                }

                // Apply sorting
                if (sortBy) {
                    const [field, order] = sortBy.split('_');
                    events.sort((a, b) => {
                        let valueA, valueB;

                        switch(field) {
                            case 'dataInicio':
                                valueA = a.dataInicio ? new Date(a.dataInicio) : new Date(0);
                                valueB = b.dataInicio ? new Date(b.dataInicio) : new Date(0);
                                break;
                            case 'dataFim':
                                valueA = a.dataFim ? new Date(a.dataFim) : new Date(0);
                                valueB = b.dataFim ? new Date(b.dataFim) : new Date(0);
                                break;
                            case 'valorBase':
                                valueA = a.valores?.valorBase || 0;
                                valueB = b.valores?.valorBase || 0;
                                break;
                            case 'valorMinimo':
                                valueA = a.valores?.valorMinimo || 0;
                                valueB = b.valores?.valorMinimo || 0;
                                break;
                            case 'lanceAtual':
                                valueA = a.valores?.lanceAtual || 0;
                                valueB = b.valores?.lanceAtual || 0;
                                break;
                            default:
                                return 0;
                        }

                        if (order === 'asc') {
                            return valueA > valueB ? 1 : valueA < valueB ? -1 : 0;
                        } else {
                            return valueA < valueB ? 1 : valueA > valueB ? -1 : 0;
                        }
                    });
                }

                // Store filtered events
                filteredEvents[type] = events;

                // Calculate pagination
                const totalItems = events.length;
                const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
                currentPageData[type] = page;
                totalPagesData[type] = totalPages;

                // Get items for current page
                const startIdx = (page - 1) * ITEMS_PER_PAGE;
                const endIdx = startIdx + ITEMS_PER_PAGE;
                const pageEvents = events.slice(startIdx, endIdx);

                if (pageEvents.length === 0) {
                    content.innerHTML = `
                        <div class="no-data">
                            <svg class="no-data-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div class="no-data-text">Nenhum evento encontrado</div>
                        </div>
                    `;
                    document.getElementById(`pagination-${type}`).style.display = 'none';
                    return;
                }

                const grid = document.createElement('div');
                grid.className = 'events-grid';

                pageEvents.forEach(event => {
                    const card = createEventCard(event);
                    grid.appendChild(card);
                });

                content.innerHTML = '';
                content.appendChild(grid);

                updatePagination(type);

            } catch (error) {
                console.error('Erro ao carregar eventos:', error);
                content.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-text">Erro ao carregar eventos</div>
                    </div>
                `;
            }
        }

        function createEventCard(event) {
            const card = document.createElement('div');
            card.className = 'event-card';

            const typePrefix = event.reference.substring(0, 2);
            const typePrefixClass = typePrefix === 'LO' ? 'lo' : 'np';
            const eventType = event.tipoEvento === 'imovel' ? 'imovel' : 'movel';

            const formatDate = (dateStr) => {
                if (!dateStr) return 'N/A';
                const date = new Date(dateStr);
                return date.toLocaleString('pt-PT', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const formatPrice = (price) => {
                if (!price) return 'N/A';
                return new Intl.NumberFormat('pt-PT', {
                    style: 'currency',
                    currency: 'EUR'
                }).format(price);
            };

            const getValue = (val) => val || 'N/A';

            // Remove prefix LO/NP from reference text
            const referenceWithoutPrefix = event.reference.substring(2);

            // Build carousel HTML
            let carouselHTML = '';
            if (event.imagens && event.imagens.length > 0) {
                const imagesHTML = event.imagens.map((img, idx) =>
                    `<div class="event-carousel-image" style="background-image: url('${img}')"></div>`
                ).join('');

                const indicatorsHTML = event.imagens.map((_, idx) =>
                    `<div class="event-carousel-indicator ${idx === 0 ? 'active' : ''}" data-index="${idx}"></div>`
                ).join('');

                carouselHTML = `
                    <div class="event-carousel" data-reference="${event.reference}">
                        <div class="event-carousel-images">
                            ${imagesHTML}
                        </div>
                        ${event.imagens.length > 1 ? `
                            <button class="event-carousel-nav prev">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </button>
                            <button class="event-carousel-nav next">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                            <div class="event-carousel-indicators">
                                ${indicatorsHTML}
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                carouselHTML = `
                    <div class="event-carousel">
                        <div class="event-carousel-placeholder">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="width: 48px; height: 48px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                    </div>
                `;
            }

            card.innerHTML = `
                <div class="event-card-header">
                    <div class="event-ref-badge">
                        <span class="event-type-prefix ${typePrefixClass}">${typePrefix}</span>
                        <span class="event-ref-text">${referenceWithoutPrefix}</span>
                    </div>
                    <div class="event-type-badge ${eventType}">
                        ${eventType === 'imovel' ? `
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                            </svg>
                            Im√≥vel
                        ` : `
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                            </svg>
                            M√≥vel
                        `}
                    </div>
                </div>

                ${carouselHTML}

                <div class="event-card-body">
                    <!-- Informa√ß√µes B√°sicas -->
                    <div class="event-section">
                        <div class="section-title">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Informa√ß√µes B√°sicas
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Tipo:</span>
                            <span class="detail-value ${!event.detalhes.tipo || event.detalhes.tipo === 'N/A' ? 'empty' : ''}">${getValue(event.detalhes.tipo)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Subtipo:</span>
                            <span class="detail-value ${!event.detalhes.subtipo || event.detalhes.subtipo === 'N/A' ? 'empty' : ''}">${getValue(event.detalhes.subtipo)}</span>
                        </div>
                        ${event.tipoEvento === 'imovel' ? `
                            <div class="detail-row">
                                <span class="detail-label">Tipologia:</span>
                                <span class="detail-value ${!event.detalhes.tipologia ? 'empty' : ''}">${getValue(event.detalhes.tipologia)}</span>
                            </div>
                        ` : ''}
                        ${event.tipoEvento === 'movel' ? `
                            <div class="detail-row">
                                <span class="detail-label">Matr√≠cula:</span>
                                <span class="detail-value ${!event.detalhes.matricula ? 'empty' : ''}">${getValue(event.detalhes.matricula)}</span>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Valores -->
                    <div class="event-section">
                        <div class="section-title">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Valores
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Valor Base:</span>
                            <span class="detail-value ${!event.valores.valorBase ? 'empty' : 'price'}">${formatPrice(event.valores.valorBase)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Valor Abertura:</span>
                            <span class="detail-value ${!event.valores.valorAbertura ? 'empty' : 'price'}">${formatPrice(event.valores.valorAbertura)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Valor M√≠nimo:</span>
                            <span class="detail-value ${!event.valores.valorMinimo ? 'empty' : 'price'}">${formatPrice(event.valores.valorMinimo)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Lance Atual:</span>
                            <span class="detail-value ${!event.valores.lanceAtual ? 'empty' : 'price'}">${formatPrice(event.valores.lanceAtual)}</span>
                        </div>
                    </div>

                    <!-- Datas -->
                    <div class="event-section">
                        <div class="section-title">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Datas do Evento
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">In√≠cio:</span>
                            <span class="detail-value ${!event.dataInicio ? 'empty' : 'date'}">${formatDate(event.dataInicio)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Fim:</span>
                            <span class="detail-value ${!event.dataFim ? 'empty' : 'date'}">${formatDate(event.dataFim)}</span>
                        </div>
                    </div>

                    ${event.tipoEvento === 'imovel' ? `
                        <!-- Localiza√ß√£o -->
                        <div class="event-section">
                            <div class="section-title">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                Localiza√ß√£o
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Distrito:</span>
                                <span class="detail-value ${!event.detalhes.distrito ? 'empty' : ''}">${getValue(event.detalhes.distrito)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Concelho:</span>
                                <span class="detail-value ${!event.detalhes.concelho ? 'empty' : ''}">${getValue(event.detalhes.concelho)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Freguesia:</span>
                                <span class="detail-value ${!event.detalhes.freguesia ? 'empty' : ''}">${getValue(event.detalhes.freguesia)}</span>
                            </div>
                        </div>

                        <!-- √Åreas -->
                        <div class="event-section">
                            <div class="section-title">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                                </svg>
                                √Åreas
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">√Årea Privativa:</span>
                                <span class="detail-value ${!event.detalhes.areaPrivativa ? 'empty' : ''}">${event.detalhes.areaPrivativa ? event.detalhes.areaPrivativa + ' m¬≤' : 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">√Årea Dependente:</span>
                                <span class="detail-value ${!event.detalhes.areaDependente ? 'empty' : ''}">${event.detalhes.areaDependente ? event.detalhes.areaDependente + ' m¬≤' : 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">√Årea Total:</span>
                                <span class="detail-value ${!event.detalhes.areaTotal ? 'empty' : ''}">${event.detalhes.areaTotal ? event.detalhes.areaTotal + ' m¬≤' : 'N/A'}</span>
                            </div>
                        </div>
                    ` : ''}
                </div>

                <div class="card-actions">
                    <button class="card-action-btn" onclick="viewEvent('${event.reference}')" title="Ver evento no e-leiloes.pt">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        Ver
                    </button>
                    <button class="card-action-btn" onclick="reloadEvent('${event.reference}')" title="Recarregar dados do evento">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Reload
                    </button>
                    <button class="card-action-btn" onclick="openLocation(${event.gps?.latitude}, ${event.gps?.longitude})" ${!event.gps?.latitude ? 'disabled' : ''} title="Abrir localiza√ß√£o no mapa">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        Mapa
                    </button>
                </div>
            `;

            // Add carousel navigation
            if (event.imagens && event.imagens.length > 1) {
                const carousel = card.querySelector('.event-carousel');
                const imagesContainer = carousel.querySelector('.event-carousel-images');
                const prevBtn = carousel.querySelector('.prev');
                const nextBtn = carousel.querySelector('.next');
                const indicators = carousel.querySelectorAll('.event-carousel-indicator');
                let currentIndex = 0;

                const updateCarousel = (index) => {
                    currentIndex = index;
                    imagesContainer.style.transform = `translateX(-${index * 100}%)`;
                    indicators.forEach((ind, idx) => {
                        ind.classList.toggle('active', idx === index);
                    });
                };

                prevBtn?.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const newIndex = currentIndex > 0 ? currentIndex - 1 : event.imagens.length - 1;
                    updateCarousel(newIndex);
                });

                nextBtn?.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const newIndex = currentIndex < event.imagens.length - 1 ? currentIndex + 1 : 0;
                    updateCarousel(newIndex);
                });

                indicators.forEach((indicator, idx) => {
                    indicator.addEventListener('click', (e) => {
                        e.stopPropagation();
                        updateCarousel(idx);
                    });
                });
            }

            return card;
        }

        // Card Actions
        async function reloadEvent(reference) {
            try {
                // Show loading indicator
                const card = event.target.closest('.event-card');
                if (card) {
                    card.style.opacity = '0.5';
                    card.style.pointerEvents = 'none';
                }

                addLog(`üîÑ Recarregando evento: ${reference}`, 'info');

                // Force API to re-scrape the event
                const response = await fetch(`${API_BASE}/api/scrape/event/${reference}`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (response.ok) {
                    addLog(`‚úÖ Evento ${reference} recarregado com sucesso`, 'success');
                    showModal('‚úÖ Evento Atualizado', `Evento ${reference} foi atualizado com sucesso!\n\nA p√°gina vai recarregar...`);

                    // Wait a moment for the modal to be visible
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    // Reload the current page
                    const activePage = document.querySelector('.page.active').id;
                    loadEvents(activePage);
                } else {
                    addLog(`‚ùå Erro ao recarregar ${reference}: ${data.detail || 'Erro desconhecido'}`, 'error');
                    showModal('‚ùå Erro ao Recarregar', data.detail || 'Erro ao recarregar o evento. Por favor, tente novamente.');

                    if (card) {
                        card.style.opacity = '1';
                        card.style.pointerEvents = 'auto';
                    }
                }
            } catch (error) {
                console.error('Erro ao recarregar evento:', error);
                addLog(`‚ùå Erro ao recarregar ${reference}: ${error.message}`, 'error');
                showModal('‚ùå Erro', `Erro ao recarregar o evento:\n${error.message}`);

                if (card) {
                    card.style.opacity = '1';
                    card.style.pointerEvents = 'auto';
                }
            }
        }

        function openLocation(lat, lng) {
            if (lat && lng) {
                window.open(`https://www.google.com/maps?q=${lat},${lng}`, '_blank');
            }
        }

        function viewEvent(reference) {
            window.open(`https://www.e-leiloes.pt/evento/${reference}`, '_blank');
        }

        // Cascade Filters
        let allEventsCache = [];

        async function updateConcelhoFilter(type) {
            const distritoSelect = document.getElementById(`distrito-${type}`);
            const concelhoSelect = document.getElementById(`concelho-${type}`);
            const freguesiaSelect = document.getElementById(`freguesia-${type}`);

            if (!distritoSelect || !concelhoSelect) return;

            const selectedDistrito = distritoSelect.value;

            // Reset concelho and freguesia
            concelhoSelect.innerHTML = '<option value="">Todos os concelhos</option>';
            freguesiaSelect.innerHTML = '<option value="">Todas as freguesias</option>';
            freguesiaSelect.disabled = true;

            if (!selectedDistrito) {
                concelhoSelect.disabled = true;
                return;
            }

            // Fetch all events if not cached
            if (allEventsCache.length === 0) {
                try {
                    const response = await fetch(`${API_BASE}/api/events?limit=1000&tipo_evento=imovel`);
                    const data = await response.json();
                    allEventsCache = data.events;
                } catch (error) {
                    console.error('Erro ao carregar eventos para filtros:', error);
                    return;
                }
            }

            // Filter events by distrito and collect unique concelhos
            const concelhos = new Set();
            allEventsCache.forEach(event => {
                if (event.detalhes.distrito === selectedDistrito && event.detalhes.concelho) {
                    concelhos.add(event.detalhes.concelho);
                }
            });

            // Populate concelho dropdown
            Array.from(concelhos).sort().forEach(concelho => {
                const option = document.createElement('option');
                option.value = concelho;
                option.textContent = concelho;
                concelhoSelect.appendChild(option);
            });

            concelhoSelect.disabled = false;
        }

        async function updateFreguesiaFilter(type) {
            const distritoSelect = document.getElementById(`distrito-${type}`);
            const concelhoSelect = document.getElementById(`concelho-${type}`);
            const freguesiaSelect = document.getElementById(`freguesia-${type}`);

            if (!distritoSelect || !concelhoSelect || !freguesiaSelect) return;

            const selectedDistrito = distritoSelect.value;
            const selectedConcelho = concelhoSelect.value;

            // Reset freguesia
            freguesiaSelect.innerHTML = '<option value="">Todas as freguesias</option>';

            if (!selectedDistrito || !selectedConcelho) {
                freguesiaSelect.disabled = true;
                return;
            }

            // Fetch all events if not cached
            if (allEventsCache.length === 0) {
                try {
                    const response = await fetch(`${API_BASE}/api/events?limit=1000&tipo_evento=imovel`);
                    const data = await response.json();
                    allEventsCache = data.events;
                } catch (error) {
                    console.error('Erro ao carregar eventos para filtros:', error);
                    return;
                }
            }

            // Filter events by distrito and concelho, collect unique freguesias
            const freguesias = new Set();
            allEventsCache.forEach(event => {
                if (event.detalhes.distrito === selectedDistrito &&
                    event.detalhes.concelho === selectedConcelho &&
                    event.detalhes.freguesia) {
                    freguesias.add(event.detalhes.freguesia);
                }
            });

            // Populate freguesia dropdown
            Array.from(freguesias).sort().forEach(freguesia => {
                const option = document.createElement('option');
                option.value = freguesia;
                option.textContent = freguesia;
                freguesiaSelect.appendChild(option);
            });

            freguesiaSelect.disabled = false;
        }

        function updateDistritoFilter() {
            const select = document.getElementById('distrito-imoveis');
            if (!select) return;

            const currentValue = select.value;
            select.innerHTML = '<option value="">Todos os distritos</option>';

            Array.from(allDistritos).sort().forEach(distrito => {
                const option = document.createElement('option');
                option.value = distrito;
                option.textContent = distrito;
                select.appendChild(option);
            });

            select.value = currentValue;
        }

        function updatePagination(type) {
            const pagination = document.getElementById(`pagination-${type}`);
            if (!pagination) return;

            const totalFiltered = filteredEvents[type].length;

            if (totalPagesData[type] <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';
            pagination.innerHTML = `
                <button ${currentPageData[type] === 1 ? 'disabled' : ''} onclick="loadEvents('${type}', ${currentPageData[type] - 1})">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Anterior
                </button>
                <span class="page-info">P√°gina ${currentPageData[type]} de ${totalPagesData[type]} (${totalFiltered} eventos)</span>
                <button ${currentPageData[type] === totalPagesData[type] ? 'disabled' : ''} onclick="loadEvents('${type}', ${currentPageData[type] + 1})">
                    Pr√≥xima
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            `;
        }

        function clearFilters(type) {
            const searchInput = document.getElementById(`search-${type}`);
            const distritoSelect = document.getElementById(`distrito-${type}`);
            const concelhoSelect = document.getElementById(`concelho-${type}`);
            const freguesiaSelect = document.getElementById(`freguesia-${type}`);
            const sortSelect = document.getElementById(`sort-${type}`);

            if (searchInput) searchInput.value = '';
            if (distritoSelect) distritoSelect.value = '';
            if (sortSelect) sortSelect.value = '';

            if (concelhoSelect) {
                concelhoSelect.innerHTML = '<option value="">Todos os concelhos</option>';
                concelhoSelect.disabled = true;
            }
            if (freguesiaSelect) {
                freguesiaSelect.innerHTML = '<option value="">Todas as freguesias</option>';
                freguesiaSelect.disabled = true;
            }

            activeTypeFilter = null;
            document.querySelectorAll('.type-badge').forEach(b => b.classList.remove('active'));

            currentPageData[type] = 1;
            loadEvents(type, 1);
        }

        function reloadAllData(type) {
            // Clear cache to force fresh load
            allLoadedEvents[type] = [];
            filteredEvents[type] = [];
            currentPageData[type] = 1;
            loadEvents(type, 1);
        }

        // Event Listeners
        document.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                const activePage = document.querySelector('.page.active').id;
                if (activePage !== 'dashboard') {
                    loadEvents(activePage);
                }
            }
        });

        // Initial load
        restoreSidebarState();
        loadDashboard();
        startConsolePolling();
        checkPipelineStatusOnLoad(); // Retomar pipeline se ativa
        loadAutoPipelinesStatus(); // Carregar status das pipelines autom√°ticas

        // ============== MULTI-STAGE SCRAPING FUNCTIONS ==============

        // Global storage for stage results
        let stage1Results = [];
        let stage2Results = [];
        let collectedIds = []; // IDs from independent scraper
        let currentScraperDesign = 'a'; // Current active design

        // ===== SCRAPER DESIGN FUNCTIONS =====
        function switchScraperDesign(design) {
            currentScraperDesign = design;
            ['a', 'b', 'c'].forEach(d => {
                const el = document.getElementById(`scraper-design-${d}`);
                if (el) el.style.display = d === design ? 'block' : 'none';
            });
            // Update switcher buttons
            document.querySelectorAll('.design-opt-btn').forEach(btn => {
                if (btn.dataset.design === design) {
                    btn.style.background = '#6366f1';
                    btn.style.color = 'white';
                } else {
                    btn.style.background = '#f8fafc';
                    btn.style.color = '#1e293b';
                }
            });
        }

        function switchScraperTab(tab) {
            document.getElementById('tab-ids').style.display = tab === 'ids' ? 'block' : 'none';
            document.getElementById('tab-process').style.display = tab === 'process' ? 'block' : 'none';
            document.querySelectorAll('.scraper-tab').forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.style.background = 'white';
                    btn.style.color = '#1e293b';
                    btn.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
                } else {
                    btn.style.background = 'transparent';
                    btn.style.color = '#64748b';
                    btn.style.boxShadow = 'none';
                }
            });
        }

        function showSpecificIdsInput() {
            const panel = document.getElementById('specific-ids-panel-c');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            if (panel.style.display === 'block') {
                document.getElementById('specific-ids-input-c').focus();
            }
        }

        function runSpecificIds() {
            const input = document.getElementById('specific-ids-input').value;
            if (!input.trim()) {
                showModal('‚ö†Ô∏è Aviso', 'Introduz pelo menos um ID');
                return;
            }
            runIndependentScraperWithIds(input);
        }

        function runSpecificIdsB() {
            const input = document.getElementById('specific-ids-input-b').value;
            if (!input.trim()) {
                showModal('‚ö†Ô∏è Aviso', 'Introduz pelo menos um ID');
                return;
            }
            runIndependentScraperWithIds(input);
        }

        function runSpecificIdsC() {
            const input = document.getElementById('specific-ids-input-c').value;
            if (!input.trim()) {
                showModal('‚ö†Ô∏è Aviso', 'Introduz pelo menos um ID');
                return;
            }
            runIndependentScraperWithIds(input);
        }

        async function runIndependentScraperWithIds(idsString) {
            const ids = idsString.split(/[,\s\n]+/).map(s => s.trim()).filter(s => s);
            if (ids.length === 0) return;

            addLog(`üéØ A processar ${ids.length} IDs espec√≠ficos...`, 'info');
            // TODO: Implement specific IDs scraping endpoint
            showModal('üéØ IDs Espec√≠ficos', `${ids.length} IDs prontos para processar:\n${ids.join(', ')}`);
        }

        // Display collected IDs in all design versions
        function displayCollectedIds(ids) {
            collectedIds = ids;

            if (!ids || ids.length === 0) {
                ['a', 'b', 'c'].forEach(d => {
                    const section = document.getElementById(`ids-results-section-${d}`);
                    if (section) section.style.display = 'none';
                });
                return;
            }

            // Group IDs by tipo_evento
            const grouped = {};
            ids.forEach(item => {
                const tipo = item.tipo_evento || 'outros';
                if (!grouped[tipo]) grouped[tipo] = [];
                grouped[tipo].push(item.reference);
            });

            // Build HTML
            const tipoLabels = {
                'imoveis': 'üè† Im√≥veis',
                'veiculos': 'üöó Ve√≠culos',
                'direitos': 'üìú Direitos',
                'equipamentos': 'üîß Equipamentos',
                'mobiliario': 'ü™ë Mobili√°rio',
                'maquinas': '‚öôÔ∏è M√°quinas',
                'outros': 'üì¶ Outros'
            };

            let html = '';
            Object.keys(grouped).forEach(tipo => {
                const label = tipoLabels[tipo] || tipo;
                const refs = grouped[tipo];
                html += `<div style="margin-bottom: 8px;">
                    <div style="font-size: 11px; font-weight: 600; color: #64748b; margin-bottom: 4px;">${label} (${refs.length})</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        ${refs.map(ref => `<span style="background: #e0e7ff; color: #3730a3; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-family: monospace;">${ref}</span>`).join('')}
                    </div>
                </div>`;
            });

            // Update all design versions
            ['a', 'b', 'c'].forEach(d => {
                const section = document.getElementById(`ids-results-section-${d}`);
                const list = document.getElementById(`ids-results-list-${d}`);
                const badge = document.getElementById(`ids-count-badge-${d}`);
                if (section) section.style.display = 'block';
                if (list) list.innerHTML = html;
                if (badge) badge.textContent = ids.length;
            });
        }

        // Copy IDs to clipboard
        function copyIdsToClipboard() {
            if (collectedIds.length === 0) return;
            const text = collectedIds.map(item => item.reference).join('\n');
            navigator.clipboard.writeText(text).then(() => {
                addLog(`üìã ${collectedIds.length} IDs copiados para clipboard`, 'success');
            });
        }

        // Clear collected IDs
        function clearCollectedIds() {
            collectedIds = [];
            ['a', 'b', 'c'].forEach(d => {
                const section = document.getElementById(`ids-results-section-${d}`);
                if (section) section.style.display = 'none';
            });
            addLog('üóëÔ∏è IDs limpos', 'info');
        }

        // Toggle modes for Stage 2
        function toggleStage2Mode() {
            const source = document.getElementById('stage2-source').value;
            const idsTextarea = document.getElementById('stage2-ids');
            const btn = document.getElementById('btn-stage2');

            if (source === 'manual') {
                idsTextarea.style.display = 'block';
                btn.disabled = false;
            } else if (source === 'stage1') {
                idsTextarea.style.display = 'none';
                btn.disabled = stage1Results.length === 0;
            } else if (source === 'new') {
                idsTextarea.style.display = 'none';
                btn.disabled = false;
            }
        }

        // Toggle modes for Stage 3
        function toggleStage3Mode() {
            const source = document.getElementById('stage3-source').value;
            const idsTextarea = document.getElementById('stage3-ids');
            const btn = document.getElementById('btn-stage3');

            if (source === 'manual') {
                idsTextarea.style.display = 'block';
                btn.disabled = false;
            } else if (source === 'stage1') {
                idsTextarea.style.display = 'none';
                btn.disabled = stage1Results.length === 0;
            } else if (source === 'stage2') {
                idsTextarea.style.display = 'none';
                btn.disabled = stage2Results.length === 0;
            } else if (source === 'missing') {
                idsTextarea.style.display = 'none';
                btn.disabled = false;
            }
        }

        // Stage 1: Discover IDs
        async function runStage1() {
            const btn = document.getElementById('btn-stage1');
            const result = document.getElementById('stage1-result');
            const tipo = document.getElementById('stage1-tipo').value;
            const pages = document.getElementById('stage1-pages').value;

            try {
                btn.disabled = true;
                btn.textContent = '‚è≥ A descobrir...';
                result.className = 'stage-result loading';
                result.textContent = 'A processar...';

                let url = `${API_BASE}/api/scrape/stage1/ids?`;
                if (tipo) url += `tipo=${tipo}&`;
                if (pages) url += `max_pages=${pages}`;

                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (response.ok) {
                    stage1Results = data.ids || [];
                    result.className = 'stage-result success';
                    result.textContent = `${stage1Results.length} IDs`;

                    // Enable stage 2 and 3
                    document.getElementById('btn-stage2').disabled = false;
                    toggleStage3Mode();

                    alert(`‚úÖ Stage 1 completo!\n\n${stage1Results.length} eventos descobertos`);
                } else {
                    throw new Error(data.detail || 'Erro desconhecido');
                }

            } catch (error) {
                result.className = 'stage-result';
                result.textContent = 'Erro';
                alert(`‚ùå Erro no Stage 1:\n${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîç Descobrir IDs';
            }
        }

        // Stage 2: Extract Details
        async function runStage2() {
            const btn = document.getElementById('btn-stage2');
            const result = document.getElementById('stage2-result');
            const source = document.getElementById('stage2-source').value;

            try {
                btn.disabled = true;
                btn.textContent = '‚è≥ A extrair...';
                result.className = 'stage-result loading';
                result.textContent = 'A processar...';

                let references = [];

                if (source === 'stage1') {
                    references = stage1Results.map(item => item.reference);
                } else if (source === 'manual') {
                    const idsText = document.getElementById('stage2-ids').value;
                    references = idsText.split(',').map(s => s.trim()).filter(s => s);
                } else if (source === 'new') {
                    // SMART SCRAPING: Identifica automaticamente eventos novos
                    btn.textContent = 'üß† A identificar novos...';

                    // Chama endpoint de smart scraping
                    const smartUrl = `${API_BASE}/api/scrape/smart/new-events`;
                    const smartResponse = await fetch(smartUrl, { method: 'POST' });
                    const smartData = await smartResponse.json();

                    if (!smartResponse.ok) {
                        throw new Error(smartData.detail || 'Erro no scrape inteligente');
                    }

                    if (smartData.new_events === 0) {
                        alert(`‚ÑπÔ∏è Scrape Inteligente\n\n‚úÖ Nenhum evento novo!\n\nTotal scraped: ${smartData.total_scraped}\nJ√° na BD: ${smartData.already_in_db}`);
                        result.className = 'stage-result success';
                        result.textContent = '0 novos';
                        return;
                    }

                    // Usa os IDs novos
                    references = smartData.new_ids.map(item => item.reference);
                    alert(`üß† Scrape Inteligente\n\n‚ú® ${smartData.new_events} eventos novos identificados!\n\nTotal scraped: ${smartData.total_scraped}\nJ√° na BD: ${smartData.already_in_db}`);
                }

                if (references.length === 0) {
                    alert('Nenhum ID para processar!');
                    return;
                }

                btn.textContent = '‚è≥ A extrair detalhes...';
                const url = `${API_BASE}/api/scrape/stage2/details?` + references.map(ref => `references=${encodeURIComponent(ref)}`).join('&');

                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (response.ok) {
                    stage2Results = data.events || [];
                    result.className = 'stage-result success';
                    result.textContent = `${stage2Results.length} eventos`;

                    // Enable stage 3
                    toggleStage3Mode();

                    alert(`‚úÖ Stage 2 completo!\n\n${stage2Results.length} eventos processados`);
                    loadDashboard();
                } else {
                    throw new Error(data.detail || 'Erro desconhecido');
                }

            } catch (error) {
                result.className = 'stage-result';
                result.textContent = 'Erro';
                alert(`‚ùå Erro no Stage 2:\n${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üìã Extrair Detalhes';
            }
        }

        // Stage 3: Download Images
        async function runStage3() {
            const btn = document.getElementById('btn-stage3');
            const result = document.getElementById('stage3-result');
            const source = document.getElementById('stage3-source').value;

            try {
                btn.disabled = true;
                btn.textContent = '‚è≥ A transferir...';
                result.className = 'stage-result loading';
                result.textContent = 'A processar...';

                let references = [];

                if (source === 'stage2') {
                    references = stage2Results.map(event => event.reference);
                } else if (source === 'stage1') {
                    references = stage1Results.map(item => item.reference);
                } else if (source === 'manual') {
                    const idsText = document.getElementById('stage3-ids').value;
                    references = idsText.split(',').map(s => s.trim()).filter(s => s);
                } else if (source === 'missing') {
                    const eventsResponse = await fetch(`${API_BASE}/api/events?limit=5000`);
                    const eventsData = await eventsResponse.json();
                    references = eventsData.events.filter(e => !e.imagens || e.imagens.length === 0).map(e => e.reference);
                }

                if (references.length === 0) {
                    alert('Nenhum ID para processar!');
                    return;
                }

                const url = `${API_BASE}/api/scrape/stage3/images?` + references.map(ref => `references=${encodeURIComponent(ref)}`).join('&');

                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (response.ok) {
                    const imagesMap = data.images_map || {};
                    const totalImages = Object.values(imagesMap).reduce((sum, imgs) => sum + imgs.length, 0);

                    result.className = 'stage-result success';
                    result.textContent = `${totalImages} imagens`;

                    alert(`‚úÖ Stage 3 completo!\n\n${Object.keys(imagesMap).length} eventos\n${totalImages} imagens`);
                    loadDashboard();
                } else {
                    throw new Error(data.detail || 'Erro desconhecido');
                }

            } catch (error) {
                result.className = 'stage-result';
                result.textContent = 'Erro';
                alert(`‚ùå Erro no Stage 3:\n${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üñºÔ∏è Download Imagens';
            }
        }

        // Run Full Pipeline
        async function runIndependentScraper(type) {
            // Get tipo from the active design's selector
            const tipoSelectors = ['independent-tipo-a', 'independent-tipo-b', 'independent-tipo-c', 'independent-tipo'];
            let tipo = '';
            for (const id of tipoSelectors) {
                const el = document.getElementById(id);
                if (el && el.value) {
                    tipo = el.value;
                    break;
                }
            }
            const pagesEl = document.getElementById('independent-pages');
            const pages = pagesEl ? pagesEl.value : '';

            try {
                addLog(`‚ñ∂ Executando scraper: ${type.toUpperCase()}`, 'info');

                // Iniciar polling de feedback em tempo real
                startPipelinePolling();

                let url, message;

                switch(type) {
                    case 'ids':
                        url = `${API_BASE}/api/scrape/stage1/ids?`;
                        if (tipo) url += `tipo=${tipo}&`;
                        if (pages) url += `max_pages=${pages}`;
                        message = 'üîç Stage 1: A obter IDs...';
                        break;

                    case 'recheck':
                        url = `${API_BASE}/api/scrape/smart/new-events?`;
                        if (tipo) url += `tipo=${tipo}&`;
                        if (pages) url += `max_pages=${pages}`;
                        message = 'üîÑ Smart Scraping: A verificar novos eventos...';
                        break;

                    case 'content':
                        // Get all references from DB first (no limit - fetch all)
                        const refsResponse = await fetch(`${API_BASE}/api/events?limit=100000`);
                        const refsData = await refsResponse.json();
                        const references = refsData.events.map(e => e.reference);

                        if (references.length === 0) {
                            showModal('‚ö†Ô∏è Aviso', 'Nenhum evento na BD. Execute "Scrape IDs" primeiro.');
                            return;
                        }

                        url = `${API_BASE}/api/scrape/stage2/details?save_to_db=true&` + references.map(ref => `references=${encodeURIComponent(ref)}`).join('&');
                        message = `üìã Stage 2: A extrair detalhes de ${references.length} eventos...`;
                        break;

                    case 'images':
                        // Get all references from DB first (no limit - fetch all)
                        const imgRefsResponse = await fetch(`${API_BASE}/api/events?limit=100000`);
                        const imgRefsData = await imgRefsResponse.json();
                        const imgReferences = imgRefsData.events.map(e => e.reference);

                        if (imgReferences.length === 0) {
                            showModal('‚ö†Ô∏è Aviso', 'Nenhum evento na BD. Execute "Scrape IDs" primeiro.');
                            return;
                        }

                        url = `${API_BASE}/api/scrape/stage3/images?` + imgReferences.map(ref => `references=${encodeURIComponent(ref)}`).join('&');
                        message = `üñºÔ∏è Stage 3: A fazer download de imagens de ${imgReferences.length} eventos...`;
                        break;

                    default:
                        throw new Error('Tipo de scraper desconhecido');
                }

                addLog(message, 'info');

                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (response.ok) {
                    addLog(`‚úÖ ${type.toUpperCase()}: ${data.message || 'Conclu√≠do!'}`, 'success');
                    addLog(`üìä Total: ${data.total_scraped || data.new_events || 0} eventos`, 'info');

                    // If IDs scraper, display collected IDs
                    if (type === 'ids' && data.ids && data.ids.length > 0) {
                        displayCollectedIds(data.ids);
                    }

                    // Reload dashboard after scraping
                    setTimeout(() => loadDashboard(), 1000);
                } else {
                    throw new Error(data.detail || 'Erro desconhecido');
                }

            } catch (error) {
                addLog(`‚ùå Erro no scraper ${type}: ${error.message}`, 'error');
                showModal('‚ùå Erro', error.message);
            }
        }

        // Toggle between run and stop pipeline
        function togglePipeline() {
            if (pipelineRunning) {
                stopPipeline();
            } else {
                runPipeline();
            }
        }

        // Stop pipeline execution (Kill)
        async function stopPipeline() {
            const btn = document.getElementById('btn-pipeline');
            btn.disabled = true;
            btn.textContent = '‚è≥ A terminar...';

            try {
                // Call backend kill endpoint to stop pipeline
                const response = await fetch(`${API_BASE}/api/pipeline/kill`, {
                    method: 'POST'
                });
                const data = await response.json();

                if (response.ok) {
                    addLog('üõë Pipeline: Terminada com sucesso', 'warning');
                    if (data.killed_stage) {
                        addLog(`  ‚îî‚îÄ Stage ${data.killed_stage} (${data.killed_stage_name}) foi interrompida`, 'info');
                    }
                } else {
                    addLog(`‚ö†Ô∏è Erro ao parar pipeline: ${data.detail || 'Erro desconhecido'}`, 'error');
                }
            } catch (error) {
                addLog(`‚ö†Ô∏è Erro ao parar pipeline: ${error.message}`, 'error');
            }

            // Abort client-side request if exists
            if (pipelineAbortController) {
                pipelineAbortController.abort();
                pipelineAbortController = null;
            }

            // Stop polling
            stopPipelinePolling();

            pipelineRunning = false;
            btn.textContent = '‚ñ∂ Executar Pipeline';
            btn.className = 'scraper-btn start';
            btn.disabled = false;
            btn.style.background = '';
            btn.style.color = '';

            // Hide feedback box
            const feedbackBox = document.getElementById('pipeline-feedback');
            if (feedbackBox) feedbackBox.style.display = 'none';

            // Reset pipeline visualization
            updatePipelineStage(1, 'pending', 0);
            updatePipelineStage(2, 'pending', 0);
            updatePipelineStage(3, 'pending', 0);
            updatePipelineProgress(0);
        }

        async function runPipeline() {
            const btn = document.getElementById('btn-pipeline');
            const tipoEl = document.getElementById('independent-tipo');
            const pagesEl = document.getElementById('independent-pages');
            const tipo = tipoEl ? tipoEl.value : '';
            const pages = pagesEl ? pagesEl.value : '';

            try {
                // Set running state
                pipelineRunning = true;

                // Update button to show "Kill" option
                btn.disabled = false;
                btn.textContent = 'üõë Kill Pipeline';
                btn.className = 'scraper-btn stop';
                btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                btn.style.color = 'white';

                addLog('üöÄ Pipeline: Iniciando pipeline completo...', 'info');

                // Reset pipeline visualization
                updatePipelineStage(1, 'active', 0);
                updatePipelineStage(2, 'pending', 0);
                updatePipelineStage(3, 'pending', 0);
                updatePipelineProgress(0);

                // Show feedback box
                const feedbackBox = document.getElementById('pipeline-feedback');
                if (feedbackBox) {
                    feedbackBox.style.display = 'block';
                    updateFeedback('A iniciar pipeline...', 0, 0);
                }

                // Build URL
                let url = `${API_BASE}/api/scrape/pipeline?`;
                if (tipo) url += `tipo=${tipo}&`;
                if (pages) url += `max_pages=${pages}`;

                // Start the pipeline (runs in background)
                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (response.ok) {
                    // Pipeline started successfully - start polling for real-time updates
                    addLog('‚úÖ Pipeline iniciado em background', 'success');
                    startPipelinePolling();
                } else {
                    throw new Error(data.detail || 'Erro ao iniciar pipeline');
                }

            } catch (error) {
                addLog(`‚ùå Pipeline: ${error.message}`, 'error');

                // Reset button state on error
                pipelineRunning = false;
                btn.disabled = false;
                btn.textContent = '‚ñ∂ Executar Pipeline';
                btn.className = 'scraper-btn start';
                btn.style.background = '';
                btn.style.color = '';

                const feedbackBox = document.getElementById('pipeline-feedback');
                if (feedbackBox) feedbackBox.style.display = 'none';
            }
            // Note: Don't reset button here - polling will handle it when pipeline completes
        }

        // Helper functions for pipeline visualization
        function updatePipelineStage(stageNum, status, count) {
            const circle = document.getElementById(`stage${stageNum}-circle`);
            const countEl = document.getElementById(`stage${stageNum}-count`);

            // Update count
            if (countEl && count > 0) {
                countEl.textContent = `${count} eventos`;
                countEl.style.color = '#10b981';
            }

            // Update circle style based on status
            if (circle) {
                if (status === 'active') {
                    circle.style.borderColor = '#3b82f6';
                    circle.style.background = '#eff6ff';
                    circle.style.transform = 'scale(1.1)';
                } else if (status === 'completed') {
                    circle.style.borderColor = '#10b981';
                    circle.style.background = '#f0fdf4';
                    circle.style.transform = 'scale(1)';
                } else {
                    circle.style.borderColor = '#cbd5e1';
                    circle.style.background = 'white';
                    circle.style.transform = 'scale(1)';
                }
            }
        }

        function updatePipelineProgress(percent) {
            const progressLine = document.getElementById('pipeline-progress-line');
            if (progressLine) {
                progressLine.style.width = `${percent}%`;
            }
        }

        function updateFeedback(action, current, total) {
            const actionEl = document.getElementById('feedback-action');
            const countEl = document.getElementById('feedback-count');
            const progressBar = document.getElementById('feedback-progress-bar');
            if (actionEl) actionEl.textContent = action;
            if (countEl) countEl.textContent = `${current} / ${total}`;
            if (progressBar) progressBar.style.width = total > 0 ? `${(current / total) * 100}%` : '0%';
        }

        // ============== PIPELINE REAL-TIME FEEDBACK SYSTEM ==============
        let pipelinePollingInterval = null;

        // Verificar estado da pipeline ao carregar a p√°gina
        async function checkPipelineStatusOnLoad() {
            try {
                const response = await fetch(`${API_BASE}/api/pipeline/status`);
                if (response.ok) {
                    const state = await response.json();
                    if (state.active) {
                        // Pipeline est√° ativa, retomar monitoring
                        console.log('üîÑ Pipeline ativa detectada, retomando monitoring...');
                        addLog('üîÑ Pipeline ativa detectada, retomando monitoring...', 'info');

                        // Update button to show "Kill" state
                        pipelineRunning = true;
                        const btn = document.getElementById('btn-pipeline');
                        if (btn) {
                            btn.disabled = false;
                            btn.textContent = 'üõë Kill Pipeline';
                            btn.className = 'scraper-btn stop';
                            btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                            btn.style.color = 'white';
                        }

                        // Show feedback box and update from state
                        const feedbackBox = document.getElementById('pipeline-feedback');
                        if (feedbackBox) {
                            feedbackBox.style.display = 'block';
                        }

                        // Update visualization from current state
                        updatePipelineFromState(state);

                        startPipelinePolling();
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar estado da pipeline:', error);
            }
        }

        async function startPipelinePolling() {
            // Limpar polling anterior se existir
            if (pipelinePollingInterval) {
                clearInterval(pipelinePollingInterval);
            }

            // Mostrar feedback box
            const feedbackBox = document.getElementById('pipeline-feedback');
            if (feedbackBox) {
                feedbackBox.style.display = 'block';
            }

            // Fazer polling a cada 500ms
            pipelinePollingInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/pipeline/status`);
                    if (response.ok) {
                        const state = await response.json();
                        updatePipelineFromState(state);

                        // Parar polling se pipeline n√£o est√° ativa
                        if (!state.active) {
                            stopPipelinePolling();
                        }
                    }
                } catch (error) {
                    console.error('Erro ao fazer polling do estado da pipeline:', error);
                }
            }, 500);

            addLog('üîÑ Monitoring pipeline em tempo real...', 'info');
        }

        function stopPipelinePolling() {
            if (pipelinePollingInterval) {
                clearInterval(pipelinePollingInterval);
                pipelinePollingInterval = null;
            }

            // Reset button state
            pipelineRunning = false;
            const btn = document.getElementById('btn-pipeline');
            if (btn) {
                btn.textContent = '‚ñ∂ Executar Pipeline';
                btn.className = 'scraper-btn start';
                btn.disabled = false;
                btn.style.background = '';
                btn.style.color = '';
            }

            // Esconder feedback box ap√≥s 2 segundos
            setTimeout(() => {
                const feedbackBox = document.getElementById('pipeline-feedback');
                if (feedbackBox) {
                    feedbackBox.style.display = 'none';
                }
                // Refresh dashboard stats
                loadDashboard();
            }, 2000);
        }

        function updatePipelineFromState(state) {
            if (!state || !state.active) {
                return;
            }

            const { stage, stage_name, current, total, message, errors, details } = state;

            // Atualizar feedback box
            const feedbackStatus = document.getElementById('feedback-status');
            if (feedbackStatus) {
                feedbackStatus.textContent = stage_name || 'A processar...';
            }

            // Atualizar feedback-action com a mensagem de totais
            const actionEl = document.getElementById('feedback-action');
            const countEl = document.getElementById('feedback-count');
            const progressBar = document.getElementById('feedback-progress-bar');

            if (actionEl) {
                actionEl.textContent = message || 'A processar...';
            }

            // Para Stage 1, mostrar total de IDs; para outros, mostrar progresso
            if (stage === 1) {
                const totalIds = details?.total_ids || current;
                const typesDone = details?.types_done || 0;
                if (countEl) countEl.textContent = `${totalIds} IDs (${typesDone}/6 tipos)`;
                // Progress based on types done
                if (progressBar) progressBar.style.width = `${(typesDone / 6) * 100}%`;
                updatePipelineStage(1, 'active', totalIds);
                updatePipelineStage(2, 'pending', 0);
                updatePipelineStage(3, 'pending', 0);
                updatePipelineProgress((typesDone / 6) * 33);

                // Display collected IDs in independent scraper section
                if (details?.ids && details.ids.length > 0) {
                    displayCollectedIds(details.ids);
                }
            } else if (stage === 2) {
                if (countEl) countEl.textContent = `${current} / ${total}`;
                if (progressBar) progressBar.style.width = total > 0 ? `${(current / total) * 100}%` : '0%';
                updatePipelineStage(1, 'completed', total);
                updatePipelineStage(2, 'active', current);
                updatePipelineStage(3, 'pending', 0);
                updatePipelineProgress(33 + Math.min((current / total) * 33, 33));
            } else if (stage === 3) {
                if (countEl) countEl.textContent = `${current} / ${total}`;
                if (progressBar) progressBar.style.width = total > 0 ? `${(current / total) * 100}%` : '0%';
                updatePipelineStage(1, 'completed', total);
                updatePipelineStage(2, 'completed', total);
                updatePipelineStage(3, 'active', current);
                updatePipelineProgress(66 + Math.min((current / total) * 34, 34));
            }

            // Mostrar erros se existirem
            if (errors && errors.length > 0) {
                errors.forEach(err => {
                    addLog(`‚ö†Ô∏è Erro: ${err.error}`, 'error');
                });
            }

            // Log de progresso detalhado
            if (current > 0) {
                console.log(`üìä Pipeline: Stage ${stage} - ${message}`);
            }
        }

        // ============== END PIPELINE REAL-TIME FEEDBACK SYSTEM ==============

        // ============== AUTOMATIC PIPELINES SYSTEM ==============

        // Load pipeline states on page load
        // Pipeline X Countdown Functions
        async function updatePipelineXCacheInfo() {
            try {
                const response = await fetch(`${API_BASE}/api/auto-pipelines/prices/cache-info`);
                if (response.ok) {
                    const data = await response.json();
                    pipelineXCachedEvents = data.cached_events || 0;
                }
            } catch (error) {
                console.error('Erro ao buscar info do cache Pipeline X:', error);
            }
        }

        function updatePipelineXDisplay() {
            const statusDiv = document.getElementById('auto-pipeline-prices-status');
            const statusText = statusDiv?.querySelector('.status-text');
            if (statusText) {
                if (pipelineXCachedEvents === 0) {
                    statusText.textContent = '‚è∏Ô∏è Aguardando eventos terminando em < 6 minutos...';
                } else {
                    statusText.textContent = `‚ö° Executando a cada ${pipelineXCountdown} segundo${pipelineXCountdown !== 1 ? 's' : ''} ‚Ä¢ ${pipelineXCachedEvents} evento${pipelineXCachedEvents !== 1 ? 's' : ''} na cache`;
                }
            }
        }

        function startPipelineXCountdown() {
            stopPipelineXCountdown(); // Clear any existing interval
            pipelineXCountdown = 5;

            // Update cache info immediately
            updatePipelineXCacheInfo();
            updatePipelineXDisplay();

            pipelineXCountdownInterval = setInterval(() => {
                pipelineXCountdown--;
                if (pipelineXCountdown < 1) {
                    pipelineXCountdown = 5;
                    // Refresh cache info every 5 seconds (to detect new events)
                    updatePipelineXCacheInfo();
                }
                updatePipelineXDisplay();
            }, 1000);
        }

        function stopPipelineXCountdown() {
            if (pipelineXCountdownInterval) {
                clearInterval(pipelineXCountdownInterval);
                pipelineXCountdownInterval = null;
            }
        }

        async function loadAutoPipelinesStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/auto-pipelines/status`);
                if (response.ok) {
                    const data = await response.json();

                    // Update UI with current status
                    for (const [type, config] of Object.entries(data.pipelines || {})) {
                        const checkbox = document.getElementById(`auto-pipeline-${type}`);
                        const statusDiv = document.getElementById(`auto-pipeline-${type}-status`);

                        if (checkbox) {
                            checkbox.checked = config.enabled;
                        }

                        if (statusDiv && config.enabled) {
                            statusDiv.style.display = 'block';
                            const statusText = statusDiv.querySelector('.status-text');
                            if (statusText) {
                                // Special message for Pipeline X (5-second interval with countdown)
                                if (type === 'prices') {
                                    startPipelineXCountdown();
                                } else {
                                    // Show "Running..." if is_running, otherwise show next_run
                                    if (config.is_running) {
                                        statusText.textContent = 'üîÑ A executar agora...';
                                        statusText.style.fontWeight = '600';
                                        statusText.style.color = '#3b82f6';
                                    } else {
                                        statusText.textContent = `Pr√≥xima execu√ß√£o: ${config.next_run || 'Calculando...'}`;
                                        statusText.style.fontWeight = '';
                                        statusText.style.color = '';
                                    }
                                }
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar status das pipelines autom√°ticas:', error);
            }
        }

        // Poll pipeline status every 3 seconds to update "is_running" state
        setInterval(loadAutoPipelinesStatus, 3000);

        async function toggleAutoPipeline(type, enabled) {
            try {
                addLog(`${enabled ? 'üü¢' : 'üî¥'} Auto-Pipeline ${type}: ${enabled ? 'Ativada' : 'Desativada'}`, 'info');

                const response = await fetch(`${API_BASE}/api/auto-pipelines/${type}/toggle?enabled=${enabled}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });

                const data = await response.json();

                if (response.ok) {
                    const statusDiv = document.getElementById(`auto-pipeline-${type}-status`);

                    if (enabled) {
                        statusDiv.style.display = 'block';
                        const statusText = statusDiv.querySelector('.status-text');
                        if (statusText) {
                            // Special message for Pipeline X (5-second interval with countdown)
                            if (type === 'prices') {
                                startPipelineXCountdown();
                            } else {
                                statusText.textContent = data.next_run ?
                                    `Pr√≥xima execu√ß√£o: ${data.next_run}` :
                                    'Agendamento ativo';
                            }
                        }

                        showModal('‚úÖ Pipeline Ativada', `Pipeline ${type} foi ativada com sucesso!\n${data.message || ''}`);
                    } else {
                        statusDiv.style.display = 'none';
                        // Stop countdown if Pipeline X is disabled
                        if (type === 'prices') {
                            stopPipelineXCountdown();
                        }
                        showModal('‚è∏Ô∏è Pipeline Desativada', `Pipeline ${type} foi desativada.`);
                    }

                    addLog(`‚úÖ Auto-Pipeline ${type}: ${data.message}`, 'success');
                } else {
                    throw new Error(data.detail || 'Erro ao alterar estado da pipeline');
                }
            } catch (error) {
                addLog(`‚ùå Erro ao alterar pipeline ${type}: ${error.message}`, 'error');
                showModal('‚ùå Erro', error.message);

                // Revert checkbox
                const checkbox = document.getElementById(`auto-pipeline-${type}`);
                if (checkbox) {
                    checkbox.checked = !enabled;
                }
            }
        }

        // ============== END AUTOMATIC PIPELINES SYSTEM ==============

        // Console Functions
        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('btn-autoscroll');
            btn.textContent = autoScroll ? 'üìå Auto-scroll: ON' : 'üìå Auto-scroll: OFF';
        }

        function clearConsole() {
            const consoleEl = document.getElementById('console-output');
            if (consoleEl) {
                consoleEl.innerHTML = '<div style="color: #6b7280;">üü¢ Console limpo. A aguardar logs...</div>';
            }
        }

        function addLog(message, level = 'info') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString('pt-PT');

            let color = '#d4d4d4';  // default
            let icon = '‚ÑπÔ∏è';

            if (level === 'success') {
                color = '#10b981';
                icon = '‚úÖ';
            } else if (level === 'error') {
                color = '#ef4444';
                icon = '‚ùå';
            } else if (level === 'warning') {
                color = '#f59e0b';
                icon = '‚ö†Ô∏è';
            } else if (level === 'info') {
                color = '#3b82f6';
                icon = '‚ÑπÔ∏è';
            }

            // If console-output element doesn't exist, just log to browser console
            if (!consoleOutput) {
                console.log(`[${level.toUpperCase()}] ${message}`);
                return;
            }

            const logEntry = document.createElement('div');
            logEntry.style.color = color;
            logEntry.innerHTML = `<span style="color: #6b7280;">[${timestamp}]</span> ${icon} ${message}`;

            consoleOutput.appendChild(logEntry);

            // Auto-scroll if enabled
            if (autoScroll) {
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }

            // Limit to 100 log entries
            while (consoleOutput.children.length > 100) {
                consoleOutput.removeChild(consoleOutput.firstChild);
            }
        }

        // Start console polling (check for new logs every 2 seconds)
        function startConsolePolling() {
            if (consolePollingInterval) {
                clearInterval(consolePollingInterval);
            }

            // Initial log
            addLog('Console iniciado. Monitoriza√ß√£o ativa.', 'success');

            // Poll every 2 seconds (can be adjusted)
            consolePollingInterval = setInterval(async () => {
                try {
                    // Fetch logs from backend (we'll create this endpoint)
                    const response = await fetch(`${API_BASE}/api/logs`, { method: 'GET' });
                    if (response.ok) {
                        const data = await response.json();
                        if (data.logs && data.logs.length > 0) {
                            data.logs.forEach(log => {
                                addLog(log.message, log.level);
                            });
                        }
                    }
                } catch (error) {
                    // Silently fail - don't spam console with errors
                }
            }, 2000);
        }

        // Stop console polling
        function stopConsolePolling() {
            if (consolePollingInterval) {
                clearInterval(consolePollingInterval);
                consolePollingInterval = null;
            }
        }

        // Generic Modal Functions
        function showModal(title, message) {
            const modal = document.getElementById('generic-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalIcon = document.getElementById('modal-icon');

            // Set content
            modalTitle.textContent = title;
            modalMessage.textContent = message;

            // Set icon based on title
            if (title.includes('‚ùå') || title.includes('Erro')) {
                modalIcon.textContent = '‚ùå';
            } else if (title.includes('‚ö†Ô∏è') || title.includes('Aviso')) {
                modalIcon.textContent = '‚ö†Ô∏è';
            } else if (title.includes('‚úÖ') || title.includes('Sucesso')) {
                modalIcon.textContent = '‚úÖ';
            } else {
                modalIcon.textContent = '‚ÑπÔ∏è';
            }

            // Show modal
            modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('generic-modal');
            modal.style.display = 'none';
        }

        // Clear Database with Confirmation Modal + Timer
        function confirmClearDatabase() {
            const modal = document.getElementById('delete-confirm-modal');
            const timerDisplay = document.getElementById('delete-timer');
            const confirmBtn = document.getElementById('confirm-delete-btn');

            // Show modal
            modal.style.display = 'flex';

            // Reset timer - REDUCED TO 3 SECONDS
            let timeLeft = 3;
            timerDisplay.textContent = timeLeft;
            confirmBtn.disabled = true;
            confirmBtn.style.background = '#cbd5e1';
            confirmBtn.style.borderColor = '#cbd5e1';
            confirmBtn.style.color = '#94a3b8';
            confirmBtn.style.cursor = 'not-allowed';

            // Start countdown
            deleteTimerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(deleteTimerInterval);
                    // Enable confirm button
                    confirmBtn.disabled = false;
                    confirmBtn.style.background = '#dc2626';
                    confirmBtn.style.borderColor = '#dc2626';
                    confirmBtn.style.color = 'white';
                    confirmBtn.style.cursor = 'pointer';
                    timerDisplay.textContent = '‚úì';
                    timerDisplay.style.color = '#10b981';
                }
            }, 1000);
        }

        function cancelDeleteDatabase() {
            const modal = document.getElementById('delete-confirm-modal');
            modal.style.display = 'none';

            if (deleteTimerInterval) {
                clearInterval(deleteTimerInterval);
                deleteTimerInterval = null;
            }
        }

        async function executeDeleteDatabase() {
            const modal = document.getElementById('delete-confirm-modal');
            const confirmBtn = document.getElementById('confirm-delete-btn');

            // Disable button during execution
            confirmBtn.disabled = true;
            confirmBtn.textContent = '‚è≥ A processar...';

            try {
                const response = await fetch(`${API_BASE}/api/database`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (response.ok) {
                    confirmBtn.textContent = '‚úì Conclu√≠do!';
                    confirmBtn.style.background = '#10b981';

                    setTimeout(() => {
                        modal.style.display = 'none';
                        showModal(
                            '‚úÖ Base de dados limpa com sucesso!',
                            `${data.deleted_events} eventos foram apagados.\n\nA p√°gina vai recarregar...`
                        );
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    }, 1000);
                } else {
                    throw new Error(data.detail || 'Erro desconhecido');
                }

            } catch (error) {
                showModal('‚ùå Erro ao limpar base de dados', error.message);
                console.error(error);
                modal.style.display = 'none';
                cancelDeleteDatabase();
            }
        }
    </script>

    <!-- Generic Alert Modal -->
    <div id="generic-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); position: relative;">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="font-size: 64px; margin-bottom: 16px;" id="modal-icon">‚ÑπÔ∏è</div>
                <h2 style="color: #1e293b; margin: 0 0 8px 0; font-size: 24px;" id="modal-title">Aviso</h2>
            </div>
            <div style="background: #f8fafc; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                <p style="color: #475569; font-size: 14px; line-height: 1.6; margin: 0;" id="modal-message">Mensagem</p>
            </div>
            <button onclick="closeModal()" style="width: 100%; padding: 14px; background: #3b82f6; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; color: white; transition: all 0.2s;">
                OK
            </button>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o de Limpeza de BD -->
    <div id="delete-confirm-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); position: relative;">
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="font-size: 64px; margin-bottom: 16px;">‚ö†Ô∏è</div>
                <h2 style="color: #dc2626; margin: 0 0 8px 0; font-size: 24px;">Limpar Base de Dados</h2>
                <p style="color: #64748b; font-size: 14px; margin: 0;">Esta a√ß√£o √© irrevers√≠vel!</p>
            </div>

            <!-- Warning Message -->
            <div style="background: #fef2f2; border: 2px solid #fecaca; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                <p style="color: #991b1b; font-size: 14px; line-height: 1.6; margin: 0;">
                    <strong>Todos os eventos ser√£o apagados permanentemente!</strong><br>
                    Esta opera√ß√£o n√£o pode ser revertida.
                </p>
            </div>

            <!-- Timer Display -->
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="font-size: 48px; font-weight: 700; color: #3b82f6;" id="delete-timer">3</div>
                <div style="font-size: 12px; color: #64748b; margin-top: 8px;">segundos restantes</div>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 12px;">
                <button onclick="cancelDeleteDatabase()" style="flex: 1; padding: 14px; background: #f1f5f9; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: #475569;">
                    ‚úó Cancelar
                </button>
                <button id="confirm-delete-btn" onclick="executeDeleteDatabase()" disabled style="flex: 1; padding: 14px; background: #cbd5e1; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.2s; color: #94a3b8;">
                    ‚úì Confirmar
                </button>
            </div>
        </div>
    </div>

</body>
</html>
