<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Leil√µes Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 24px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 4px 0 12px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 24px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header p {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .sidebar-nav {
            margin-top: 24px;
        }

        .nav-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #cbd5e1;
            font-size: 14px;
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.15);
            border-left-color: #6366f1;
            color: white;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
        }

        .nav-dropdown {
            margin-top: 4px;
        }

        .nav-dropdown-item {
            padding: 10px 24px 10px 56px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #94a3b8;
            font-size: 13px;
            font-weight: 500;
        }

        .nav-dropdown-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }

        .nav-dropdown-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #818cf8;
        }

        .nav-dropdown-item svg {
            width: 16px;
            height: 16px;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 32px;
            width: calc(100% - 260px);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 8px;
        }

        .page-header p {
            color: #64748b;
            font-size: 14px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }

        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-card-title {
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon.blue {
            background: #eff6ff;
            color: #2563eb;
        }

        .stat-icon.purple {
            background: #f5f3ff;
            color: #7c3aed;
        }

        .stat-icon.green {
            background: #f0fdf4;
            color: #16a34a;
        }

        .stat-icon svg {
            width: 22px;
            height: 22px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #0f172a;
        }

        /* Filters */
        .filters-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-input, .filter-select {
            padding: 10px 14px;
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #64748b;
            border: 1.5px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        /* Type Badges */
        .type-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .type-badge {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .type-badge.lo {
            background: #dbeafe;
            color: #1e40af;
        }

        .type-badge.lo.active {
            background: #2563eb;
            color: white;
            border-color: #1e40af;
        }

        .type-badge.np {
            background: #fce7f3;
            color: #9f1239;
        }

        .type-badge.np.active {
            background: #e11d48;
            color: white;
            border-color: #9f1239;
        }

        .type-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Events Grid */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 18px;
            margin-bottom: 32px;
        }

        /* Event Card */
        .event-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            transition: all 0.2s;
        }

        .event-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-4px);
        }

        .event-card-header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .event-ref-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .event-type-prefix {
            font-size: 13px;
            font-weight: 800;
            padding: 6px 10px;
            border-radius: 6px;
            letter-spacing: 0.8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .event-type-prefix.lo {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
        }

        .event-type-prefix.np {
            background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);
            color: white;
        }

        .event-ref-text {
            font-size: 14px;
            font-weight: 700;
            color: #e2e8f0;
        }

        .event-type-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .event-type-badge.imovel {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .event-type-badge.movel {
            background: rgba(139, 92, 246, 0.15);
            color: #8b5cf6;
        }

        .event-type-badge svg {
            width: 14px;
            height: 14px;
        }

        .event-card-body {
            padding: 14px;
        }

        .event-section {
            margin-bottom: 14px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f1f5f9;
        }

        .card-actions {
            display: flex;
            gap: 6px;
            padding: 10px 14px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .card-action-btn {
            flex: 1;
            padding: 8px;
            border: 1.5px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
        }

        .card-action-btn:hover {
            background: #6366f1;
            border-color: #6366f1;
            color: white;
            transform: translateY(-1px);
        }

        .card-action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f1f5f9;
        }

        .card-action-btn:disabled:hover {
            background: #f1f5f9;
            border-color: #e2e8f0;
            color: #94a3b8;
            transform: none;
        }

        .card-action-btn svg {
            width: 14px;
            height: 14px;
        }

        .event-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-title {
            font-size: 10px;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .section-title svg {
            width: 12px;
            height: 12px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: start;
            padding: 6px 0;
            gap: 8px;
        }

        .detail-label {
            color: #64748b;
            font-size: 11px;
            font-weight: 500;
            flex-shrink: 0;
        }

        .detail-value {
            color: #0f172a;
            font-size: 11px;
            font-weight: 600;
            text-align: right;
            word-break: break-word;
        }

        .detail-value.empty {
            color: #cbd5e1;
            font-style: italic;
        }

        .detail-value.price {
            color: #16a34a;
            font-size: 15px;
            font-weight: 700;
        }

        .detail-value.date {
            color: #ea580c;
            font-weight: 600;
        }

        /* Loading & Empty States */
        .loading {
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e2e8f0;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }

        .no-data {
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .no-data-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            color: #cbd5e1;
        }

        .no-data-text {
            color: #64748b;
            font-size: 16px;
            font-weight: 500;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 32px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .pagination button {
            padding: 10px 20px;
            border: 1.5px solid #e2e8f0;
            background: white;
            color: #475569;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .pagination button:hover:not(:disabled) {
            background: #f8fafc;
            border-color: #6366f1;
            color: #6366f1;
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination button svg {
            width: 16px;
            height: 16px;
        }

        .page-info {
            padding: 0 16px;
            font-weight: 600;
            color: #0f172a;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 220px;
            }

            .main-content {
                margin-left: 220px;
                width: calc(100% - 220px);
            }

            .events-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }

            .events-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters-bar {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
                min-width: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="width: 24px; height: 24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                E-Leil√µes
            </h1>
            <p>Sistema de Gest√£o</p>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-item active" onclick="showPage('dashboard')">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                Dashboard
            </div>

            <div class="nav-item" onclick="toggleDropdown(this)">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
                Eventos
            </div>
            <div class="nav-dropdown">
                <div class="nav-dropdown-item" onclick="showPage('imoveis')">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    Im√≥veis
                </div>
                <div class="nav-dropdown-item" onclick="showPage('moveis')">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                    </svg>
                    M√≥veis
                </div>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="page-header">
                <h2>Dashboard</h2>
                <p>Vis√£o geral de todos os eventos e leil√µes</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-header">
                        <span class="stat-card-title">Total de Eventos</span>
                        <div class="stat-icon blue">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-total">-</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <span class="stat-card-title">Im√≥veis</span>
                        <div class="stat-icon green">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-imoveis">-</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <span class="stat-card-title">M√≥veis</span>
                        <div class="stat-icon purple">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-moveis">-</div>
                </div>
            </div>

            <div id="dashboard-content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">A carregar estat√≠sticas...</div>
                </div>
            </div>
        </div>

        <!-- Im√≥veis Page -->
        <div id="imoveis" class="page">
            <div class="page-header">
                <h2>Im√≥veis</h2>
                <p>Todos os im√≥veis dispon√≠veis em leil√£o</p>
            </div>

            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)">
                    <span>LO</span>
                    <span>Leil√£o Online</span>
                </div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)">
                    <span>NP</span>
                    <span>Negocia√ß√£o Particular</span>
                </div>
            </div>

            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-imoveis" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-imoveis">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="dataInicio_asc">Data in√≠cio: mais antiga</option>
                        <option value="dataInicio_desc">Data in√≠cio: mais recente</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                        <option value="valorMinimo_asc">Valor m√≠nimo: mais baixo</option>
                        <option value="valorMinimo_desc">Valor m√≠nimo: mais alto</option>
                        <option value="lanceAtual_asc">Lance atual: mais baixo</option>
                        <option value="lanceAtual_desc">Lance atual: mais alto</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Distrito</label>
                    <select class="filter-select" id="distrito-imoveis" onchange="updateConcelhoFilter('imoveis')">
                        <option value="">Todos os distritos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Concelho</label>
                    <select class="filter-select" id="concelho-imoveis" onchange="updateFreguesiaFilter('imoveis')" disabled>
                        <option value="">Todos os concelhos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Freguesia</label>
                    <select class="filter-select" id="freguesia-imoveis" disabled>
                        <option value="">Todas as freguesias</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="loadEvents('imoveis')">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Atualizar
                    </button>
                    <button class="btn btn-secondary" onclick="clearFilters('imoveis')">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                        Limpar
                    </button>
                </div>
            </div>

            <div id="imoveis-content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">A carregar im√≥veis...</div>
                </div>
            </div>

            <div id="pagination-imoveis" class="pagination" style="display: none;"></div>
        </div>

        <!-- M√≥veis Page -->
        <div id="moveis" class="page">
            <div class="page-header">
                <h2>M√≥veis</h2>
                <p>Todos os m√≥veis dispon√≠veis em leil√£o</p>
            </div>

            <div class="type-badges">
                <div class="type-badge lo" onclick="toggleTypeFilter('LO', this)">
                    <span>LO</span>
                    <span>Leil√£o Online</span>
                </div>
                <div class="type-badge np" onclick="toggleTypeFilter('NP', this)">
                    <span>NP</span>
                    <span>Negocia√ß√£o Particular</span>
                </div>
            </div>

            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Pesquisar</label>
                    <input type="text" class="filter-input" id="search-moveis" placeholder="üîç Refer√™ncia do evento...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-select" id="sort-moveis">
                        <option value="">Selecione...</option>
                        <option value="dataFim_asc">Data fim: mais pr√≥xima</option>
                        <option value="dataFim_desc">Data fim: mais distante</option>
                        <option value="dataInicio_asc">Data in√≠cio: mais antiga</option>
                        <option value="dataInicio_desc">Data in√≠cio: mais recente</option>
                        <option value="valorBase_asc">Valor base: mais baixo</option>
                        <option value="valorBase_desc">Valor base: mais alto</option>
                        <option value="valorMinimo_asc">Valor m√≠nimo: mais baixo</option>
                        <option value="valorMinimo_desc">Valor m√≠nimo: mais alto</option>
                        <option value="lanceAtual_asc">Lance atual: mais baixo</option>
                        <option value="lanceAtual_desc">Lance atual: mais alto</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="loadEvents('moveis')">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Atualizar
                    </button>
                    <button class="btn btn-secondary" onclick="clearFilters('moveis')">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                        Limpar
                    </button>
                </div>
            </div>

            <div id="moveis-content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">A carregar m√≥veis...</div>
                </div>
            </div>

            <div id="pagination-moveis" class="pagination" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentPageData = { imoveis: 1, moveis: 1 };
        let totalPagesData = { imoveis: 1, moveis: 1 };
        let allDistritos = new Set();
        let activeTypeFilter = null;

        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

            // Show selected page
            document.getElementById(pageId).classList.add('active');

            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.nav-dropdown-item').forEach(item => item.classList.remove('active'));

            if (pageId === 'dashboard') {
                document.querySelector('.nav-item[onclick*="dashboard"]').classList.add('active');
                loadDashboard();
            } else if (pageId === 'imoveis') {
                document.querySelector('.nav-dropdown-item[onclick*="imoveis"]').classList.add('active');
                loadEvents('imoveis');
            } else if (pageId === 'moveis') {
                document.querySelector('.nav-dropdown-item[onclick*="moveis"]').classList.add('active');
                loadEvents('moveis');
            }

            // Reset type filter when changing page
            activeTypeFilter = null;
            document.querySelectorAll('.type-badge').forEach(b => b.classList.remove('active'));
        }

        function toggleDropdown(item) {
            // For now, dropdown is always visible
        }

        function toggleTypeFilter(type, element) {
            if (activeTypeFilter === type) {
                activeTypeFilter = null;
                element.classList.remove('active');
            } else {
                activeTypeFilter = type;
                document.querySelectorAll('.type-badge').forEach(b => b.classList.remove('active'));
                element.classList.add('active');
            }

            // Reload current page
            const activePage = document.querySelector('.page.active').id;
            loadEvents(activePage);
        }

        // Load Dashboard
        async function loadDashboard() {
            try {
                const response = await fetch(`${API_BASE}/api/stats`);
                const stats = await response.json();

                document.getElementById('stat-total').textContent = stats.total_events || 0;

                // Count imoveis and moveis from events
                const eventsResponse = await fetch(`${API_BASE}/api/events?limit=1000`);
                const eventsData = await eventsResponse.json();

                const imoveis = eventsData.events.filter(e => e.tipoEvento === 'imovel').length;
                const moveis = eventsData.events.filter(e => e.tipoEvento === 'movel').length;

                document.getElementById('stat-imoveis').textContent = imoveis;
                document.getElementById('stat-moveis').textContent = moveis;

                document.getElementById('dashboard-content').innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <span class="stat-card-title">Leil√£o Online (LO)</span>
                            </div>
                            <div class="stat-value">${eventsData.events.filter(e => e.reference.startsWith('LO')).length}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <span class="stat-card-title">Negocia√ß√£o Particular (NP)</span>
                            </div>
                            <div class="stat-value">${eventsData.events.filter(e => e.reference.startsWith('NP')).length}</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        // Load Events
        async function loadEvents(type, page = 1) {
            const contentId = `${type}-content`;
            const content = document.getElementById(contentId);

            content.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">A carregar ${type}...</div>
                </div>
            `;

            const searchInput = document.getElementById(`search-${type}`);
            const distritoSelect = document.getElementById(`distrito-${type}`);
            const concelhoSelect = document.getElementById(`concelho-${type}`);
            const freguesiaSelect = document.getElementById(`freguesia-${type}`);
            const sortSelect = document.getElementById(`sort-${type}`);

            const search = searchInput ? searchInput.value : '';
            const distrito = distritoSelect ? distritoSelect.value : '';
            const concelho = concelhoSelect ? concelhoSelect.value : '';
            const freguesia = freguesiaSelect ? freguesiaSelect.value : '';
            const sortBy = sortSelect ? sortSelect.value : '';

            try {
                let url = `${API_BASE}/api/events?page=${page}&limit=50`;
                url += `&tipo_evento=${type === 'imoveis' ? 'imovel' : 'movel'}`;
                if (distrito) url += `&distrito=${distrito}`;

                const response = await fetch(url);
                const data = await response.json();

                currentPageData[type] = data.page;
                totalPagesData[type] = data.pages;

                // Collect distritos
                if (type === 'imoveis') {
                    data.events.forEach(event => {
                        if (event.detalhes.distrito) {
                            allDistritos.add(event.detalhes.distrito);
                        }
                    });
                    updateDistritoFilter();
                }

                // Filter by search, type prefix, and location
                let events = data.events;
                if (search) {
                    events = events.filter(e =>
                        e.reference.toLowerCase().includes(search.toLowerCase())
                    );
                }
                if (activeTypeFilter) {
                    events = events.filter(e => e.reference.startsWith(activeTypeFilter));
                }
                if (concelho) {
                    events = events.filter(e => e.detalhes.concelho === concelho);
                }
                if (freguesia) {
                    events = events.filter(e => e.detalhes.freguesia === freguesia);
                }

                // Apply sorting
                if (sortBy) {
                    const [field, order] = sortBy.split('_');
                    events.sort((a, b) => {
                        let valueA, valueB;

                        switch(field) {
                            case 'dataInicio':
                                valueA = a.dataInicio ? new Date(a.dataInicio) : new Date(0);
                                valueB = b.dataInicio ? new Date(b.dataInicio) : new Date(0);
                                break;
                            case 'dataFim':
                                valueA = a.dataFim ? new Date(a.dataFim) : new Date(0);
                                valueB = b.dataFim ? new Date(b.dataFim) : new Date(0);
                                break;
                            case 'valorBase':
                                valueA = a.valores?.valorBase || 0;
                                valueB = b.valores?.valorBase || 0;
                                break;
                            case 'valorMinimo':
                                valueA = a.valores?.valorMinimo || 0;
                                valueB = b.valores?.valorMinimo || 0;
                                break;
                            case 'lanceAtual':
                                valueA = a.valores?.lanceAtual || 0;
                                valueB = b.valores?.lanceAtual || 0;
                                break;
                            default:
                                return 0;
                        }

                        if (order === 'asc') {
                            return valueA > valueB ? 1 : valueA < valueB ? -1 : 0;
                        } else {
                            return valueA < valueB ? 1 : valueA > valueB ? -1 : 0;
                        }
                    });
                }

                if (events.length === 0) {
                    content.innerHTML = `
                        <div class="no-data">
                            <svg class="no-data-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div class="no-data-text">Nenhum evento encontrado</div>
                        </div>
                    `;
                    document.getElementById(`pagination-${type}`).style.display = 'none';
                    return;
                }

                const grid = document.createElement('div');
                grid.className = 'events-grid';

                events.forEach(event => {
                    const card = createEventCard(event);
                    grid.appendChild(card);
                });

                content.innerHTML = '';
                content.appendChild(grid);

                updatePagination(type);

            } catch (error) {
                console.error('Erro ao carregar eventos:', error);
                content.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-text">Erro ao carregar eventos</div>
                    </div>
                `;
            }
        }

        function createEventCard(event) {
            const card = document.createElement('div');
            card.className = 'event-card';

            const typePrefix = event.reference.substring(0, 2);
            const typePrefixClass = typePrefix === 'LO' ? 'lo' : 'np';
            const eventType = event.tipoEvento === 'imovel' ? 'imovel' : 'movel';

            const formatDate = (dateStr) => {
                if (!dateStr) return 'N/A';
                const date = new Date(dateStr);
                return date.toLocaleString('pt-PT', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const formatPrice = (price) => {
                if (!price) return 'N/A';
                return new Intl.NumberFormat('pt-PT', {
                    style: 'currency',
                    currency: 'EUR'
                }).format(price);
            };

            const getValue = (val) => val || 'N/A';

            // Remove prefix LO/NP from reference text
            const referenceWithoutPrefix = event.reference.substring(2);

            card.innerHTML = `
                <div class="event-card-header">
                    <div class="event-ref-badge">
                        <span class="event-type-prefix ${typePrefixClass}">${typePrefix}</span>
                        <span class="event-ref-text">${referenceWithoutPrefix}</span>
                    </div>
                    <div class="event-type-badge ${eventType}">
                        ${eventType === 'imovel' ? `
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                            </svg>
                            Im√≥vel
                        ` : `
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                            </svg>
                            M√≥vel
                        `}
                    </div>
                </div>

                <div class="event-card-body">
                    <!-- Informa√ß√µes B√°sicas -->
                    <div class="event-section">
                        <div class="section-title">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Informa√ß√µes B√°sicas
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Tipo:</span>
                            <span class="detail-value ${!event.detalhes.tipo || event.detalhes.tipo === 'N/A' ? 'empty' : ''}">${getValue(event.detalhes.tipo)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Subtipo:</span>
                            <span class="detail-value ${!event.detalhes.subtipo || event.detalhes.subtipo === 'N/A' ? 'empty' : ''}">${getValue(event.detalhes.subtipo)}</span>
                        </div>
                        ${event.tipoEvento === 'imovel' ? `
                            <div class="detail-row">
                                <span class="detail-label">Tipologia:</span>
                                <span class="detail-value ${!event.detalhes.tipologia ? 'empty' : ''}">${getValue(event.detalhes.tipologia)}</span>
                            </div>
                        ` : ''}
                        ${event.tipoEvento === 'movel' ? `
                            <div class="detail-row">
                                <span class="detail-label">Matr√≠cula:</span>
                                <span class="detail-value ${!event.detalhes.matricula ? 'empty' : ''}">${getValue(event.detalhes.matricula)}</span>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Valores -->
                    <div class="event-section">
                        <div class="section-title">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Valores
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Valor Base:</span>
                            <span class="detail-value ${!event.valores.valorBase ? 'empty' : 'price'}">${formatPrice(event.valores.valorBase)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Valor Abertura:</span>
                            <span class="detail-value ${!event.valores.valorAbertura ? 'empty' : 'price'}">${formatPrice(event.valores.valorAbertura)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Valor M√≠nimo:</span>
                            <span class="detail-value ${!event.valores.valorMinimo ? 'empty' : 'price'}">${formatPrice(event.valores.valorMinimo)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Lance Atual:</span>
                            <span class="detail-value ${!event.valores.lanceAtual ? 'empty' : 'price'}">${formatPrice(event.valores.lanceAtual)}</span>
                        </div>
                    </div>

                    <!-- Datas -->
                    <div class="event-section">
                        <div class="section-title">
                            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Datas do Evento
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">In√≠cio:</span>
                            <span class="detail-value ${!event.dataInicio ? 'empty' : 'date'}">${formatDate(event.dataInicio)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Fim:</span>
                            <span class="detail-value ${!event.dataFim ? 'empty' : 'date'}">${formatDate(event.dataFim)}</span>
                        </div>
                    </div>

                    ${event.tipoEvento === 'imovel' ? `
                        <!-- Localiza√ß√£o -->
                        <div class="event-section">
                            <div class="section-title">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                Localiza√ß√£o
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Distrito:</span>
                                <span class="detail-value ${!event.detalhes.distrito ? 'empty' : ''}">${getValue(event.detalhes.distrito)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Concelho:</span>
                                <span class="detail-value ${!event.detalhes.concelho ? 'empty' : ''}">${getValue(event.detalhes.concelho)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Freguesia:</span>
                                <span class="detail-value ${!event.detalhes.freguesia ? 'empty' : ''}">${getValue(event.detalhes.freguesia)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">GPS Latitude:</span>
                                <span class="detail-value ${!event.gps?.latitude ? 'empty' : ''}">${event.gps?.latitude ? event.gps.latitude.toFixed(6) : 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">GPS Longitude:</span>
                                <span class="detail-value ${!event.gps?.longitude ? 'empty' : ''}">${event.gps?.longitude ? event.gps.longitude.toFixed(6) : 'N/A'}</span>
                            </div>
                        </div>

                        <!-- √Åreas -->
                        <div class="event-section">
                            <div class="section-title">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                                </svg>
                                √Åreas
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">√Årea Privativa:</span>
                                <span class="detail-value ${!event.detalhes.areaPrivativa ? 'empty' : ''}">${event.detalhes.areaPrivativa ? event.detalhes.areaPrivativa + ' m¬≤' : 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">√Årea Dependente:</span>
                                <span class="detail-value ${!event.detalhes.areaDependente ? 'empty' : ''}">${event.detalhes.areaDependente ? event.detalhes.areaDependente + ' m¬≤' : 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">√Årea Total:</span>
                                <span class="detail-value ${!event.detalhes.areaTotal ? 'empty' : ''}">${event.detalhes.areaTotal ? event.detalhes.areaTotal + ' m¬≤' : 'N/A'}</span>
                            </div>
                        </div>
                    ` : ''}
                </div>

                <div class="card-actions">
                    <button class="card-action-btn" onclick="reloadEvent('${event.reference}')" title="Recarregar dados do evento">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Reload
                    </button>
                    <button class="card-action-btn" onclick="openLocation(${event.gps?.latitude}, ${event.gps?.longitude})" ${!event.gps?.latitude ? 'disabled' : ''} title="Abrir localiza√ß√£o no mapa">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        Mapa
                    </button>
                </div>
            `;

            return card;
        }

        // Card Actions
        async function reloadEvent(reference) {
            try {
                // Show loading indicator
                const card = event.target.closest('.event-card');
                if (card) {
                    card.style.opacity = '0.5';
                    card.style.pointerEvents = 'none';
                }

                // Force API to re-scrape the event
                const response = await fetch(`${API_BASE}/api/scrape/event/${reference}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    // Wait a moment for the scraping to complete
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    // Reload the current page
                    const activePage = document.querySelector('.page.active').id;
                    loadEvents(activePage);
                } else {
                    alert('Erro ao recarregar o evento. Por favor, tente novamente.');
                    if (card) {
                        card.style.opacity = '1';
                        card.style.pointerEvents = 'auto';
                    }
                }
            } catch (error) {
                console.error('Erro ao recarregar evento:', error);
                alert('Erro ao recarregar o evento. Por favor, tente novamente.');
            }
        }

        function openLocation(lat, lng) {
            if (lat && lng) {
                window.open(`https://www.google.com/maps?q=${lat},${lng}`, '_blank');
            }
        }

        // Cascade Filters
        let allEventsCache = [];

        async function updateConcelhoFilter(type) {
            const distritoSelect = document.getElementById(`distrito-${type}`);
            const concelhoSelect = document.getElementById(`concelho-${type}`);
            const freguesiaSelect = document.getElementById(`freguesia-${type}`);

            if (!distritoSelect || !concelhoSelect) return;

            const selectedDistrito = distritoSelect.value;

            // Reset concelho and freguesia
            concelhoSelect.innerHTML = '<option value="">Todos os concelhos</option>';
            freguesiaSelect.innerHTML = '<option value="">Todas as freguesias</option>';
            freguesiaSelect.disabled = true;

            if (!selectedDistrito) {
                concelhoSelect.disabled = true;
                return;
            }

            // Fetch all events if not cached
            if (allEventsCache.length === 0) {
                try {
                    const response = await fetch(`${API_BASE}/api/events?limit=1000&tipo_evento=imovel`);
                    const data = await response.json();
                    allEventsCache = data.events;
                } catch (error) {
                    console.error('Erro ao carregar eventos para filtros:', error);
                    return;
                }
            }

            // Filter events by distrito and collect unique concelhos
            const concelhos = new Set();
            allEventsCache.forEach(event => {
                if (event.detalhes.distrito === selectedDistrito && event.detalhes.concelho) {
                    concelhos.add(event.detalhes.concelho);
                }
            });

            // Populate concelho dropdown
            Array.from(concelhos).sort().forEach(concelho => {
                const option = document.createElement('option');
                option.value = concelho;
                option.textContent = concelho;
                concelhoSelect.appendChild(option);
            });

            concelhoSelect.disabled = false;
        }

        async function updateFreguesiaFilter(type) {
            const distritoSelect = document.getElementById(`distrito-${type}`);
            const concelhoSelect = document.getElementById(`concelho-${type}`);
            const freguesiaSelect = document.getElementById(`freguesia-${type}`);

            if (!distritoSelect || !concelhoSelect || !freguesiaSelect) return;

            const selectedDistrito = distritoSelect.value;
            const selectedConcelho = concelhoSelect.value;

            // Reset freguesia
            freguesiaSelect.innerHTML = '<option value="">Todas as freguesias</option>';

            if (!selectedDistrito || !selectedConcelho) {
                freguesiaSelect.disabled = true;
                return;
            }

            // Fetch all events if not cached
            if (allEventsCache.length === 0) {
                try {
                    const response = await fetch(`${API_BASE}/api/events?limit=1000&tipo_evento=imovel`);
                    const data = await response.json();
                    allEventsCache = data.events;
                } catch (error) {
                    console.error('Erro ao carregar eventos para filtros:', error);
                    return;
                }
            }

            // Filter events by distrito and concelho, collect unique freguesias
            const freguesias = new Set();
            allEventsCache.forEach(event => {
                if (event.detalhes.distrito === selectedDistrito &&
                    event.detalhes.concelho === selectedConcelho &&
                    event.detalhes.freguesia) {
                    freguesias.add(event.detalhes.freguesia);
                }
            });

            // Populate freguesia dropdown
            Array.from(freguesias).sort().forEach(freguesia => {
                const option = document.createElement('option');
                option.value = freguesia;
                option.textContent = freguesia;
                freguesiaSelect.appendChild(option);
            });

            freguesiaSelect.disabled = false;
        }

        function updateDistritoFilter() {
            const select = document.getElementById('distrito-imoveis');
            if (!select) return;

            const currentValue = select.value;
            select.innerHTML = '<option value="">Todos os distritos</option>';

            Array.from(allDistritos).sort().forEach(distrito => {
                const option = document.createElement('option');
                option.value = distrito;
                option.textContent = distrito;
                select.appendChild(option);
            });

            select.value = currentValue;
        }

        function updatePagination(type) {
            const pagination = document.getElementById(`pagination-${type}`);
            if (!pagination) return;

            if (totalPagesData[type] <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';
            pagination.innerHTML = `
                <button ${currentPageData[type] === 1 ? 'disabled' : ''} onclick="loadEvents('${type}', ${currentPageData[type] - 1})">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Anterior
                </button>
                <span class="page-info">P√°gina ${currentPageData[type]} de ${totalPagesData[type]}</span>
                <button ${currentPageData[type] === totalPagesData[type] ? 'disabled' : ''} onclick="loadEvents('${type}', ${currentPageData[type] + 1})">
                    Pr√≥xima
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            `;
        }

        function clearFilters(type) {
            const searchInput = document.getElementById(`search-${type}`);
            const distritoSelect = document.getElementById(`distrito-${type}`);
            const concelhoSelect = document.getElementById(`concelho-${type}`);
            const freguesiaSelect = document.getElementById(`freguesia-${type}`);
            const sortSelect = document.getElementById(`sort-${type}`);

            if (searchInput) searchInput.value = '';
            if (distritoSelect) distritoSelect.value = '';
            if (sortSelect) sortSelect.value = '';

            if (concelhoSelect) {
                concelhoSelect.innerHTML = '<option value="">Todos os concelhos</option>';
                concelhoSelect.disabled = true;
            }
            if (freguesiaSelect) {
                freguesiaSelect.innerHTML = '<option value="">Todas as freguesias</option>';
                freguesiaSelect.disabled = true;
            }

            activeTypeFilter = null;
            document.querySelectorAll('.type-badge').forEach(b => b.classList.remove('active'));

            currentPageData[type] = 1;
            loadEvents(type);
        }

        // Event Listeners
        document.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                const activePage = document.querySelector('.page.active').id;
                if (activePage !== 'dashboard') {
                    loadEvents(activePage);
                }
            }
        });

        // Initial load
        loadDashboard();
    </script>
</body>
</html>
